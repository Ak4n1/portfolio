<div class="project-detail-container" *ngIf="project" [@fadeInUp]>
  <!-- Back Button -->
  <div class="back-button-container">
    <button class="back-button" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Volver a Proyectos
    </button>
  </div>

  <!-- Project Header -->
  <section class="project-header">
    <div class="container">
      <div class="project-header-content">
        <div class="project-header-text">
          <h1 class="project-title">{{ project.title }}</h1>
          <p class="project-category">{{ project.category }}</p>
          <div class="project-tags">
            <span *ngFor="let tag of project.tags" class="tag">
              {{ tag }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Project Carousel Section -->
  <section class="project-carousel-section" *ngIf="project.images && project.images.length > 0">
    <div class="container">
      <div class="carousel-wrapper">
        <div class="image-carousel">
          <div class="carousel-container">
            <img [src]="getCurrentImage()" [alt]="project.title" class="project-image-large" (click)="openModal()"
              (mouseenter)="pauseCarousel()" (mouseleave)="resumeCarousel()">

            <!-- Image counter -->
            <div class="image-counter" *ngIf="project.images.length > 1">
              {{ currentImageIndex + 1 }} / {{ project.images.length }}
            </div>
          </div>

          <!-- Navigation arrows -->
          <button class="carousel-arrow carousel-prev" *ngIf="project.images.length > 1" (click)="prevImage()">
            ‹
          </button>
          <button class="carousel-arrow carousel-next" *ngIf="project.images.length > 1" (click)="nextImage()">
            ›
          </button>

          <!-- Indicators -->
          <div class="carousel-indicators" *ngIf="project.images.length > 1">
            <span class="indicator" *ngFor="let image of project.images; let i = index"
              [class.active]="i === currentImageIndex" (click)="goToImage(i)">
            </span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Project Content Section -->
  <section class="project-content-section">
    <div class="container">
      <div class="project-content-grid">
        <!-- Project Description -->
        <div class="project-description-card">
          <h2 class="section-title">Descripción del Proyecto</h2>
          <p class="project-description" [innerHTML]="project.description"></p>

          <!-- Additional content placeholder -->
          <div class="additional-content" *ngIf="project.id === 1">
            <h3 class="content-subtitle">Funcionalidades Principales</h3>
            <ul class="features-list">
              <li><strong>Sistema de Autenticación Completo:</strong> Registro, login, recuperación de contraseña y
                verificación de email</li>
              <li><strong>Mis Personajes:</strong> Visualización de inventario de items, warehouse, skills y stats de
                los
                personajes</li>
              <li><strong>Gestión de Cuentas de Juego:</strong> Crear cuenta y cambiar contraseña de la cuenta de juego
              </li>
              <li><strong>Sistema de Pagos Integrado:</strong> Compra de Terra Coins con PayPal y MercadoPago, múltiples
                paquetes</li>
              <li><strong>Enviar Terra Coins:</strong> Las coins se pueden retirar desde el juego. En la web se solicita
                un código de 6 dígitos enviado por email para poder ingresarlo en el juego y validar la extracción.
                También se gestionan los permisos de los personajes que pueden y no pueden retirar Terra Coins en el
                juego. Si no tienen permiso, se muestra una pantalla indicando que el usuario no tiene permisos</li>
              <li><strong>Marketplace Offline:</strong> Sistema basado en el private store del juego que permite buscar
                items del mundo en la web. Los usuarios pueden encontrar el item o items y su ubicación, evitando buscar
                ciudad por ciudad y personaje por personaje</li>
              <li><strong>Sistema de Streaming:</strong> Funcionalidad para usuarios que quieren streamear el servidor,
                con una sección especial en la web y recompensas en el juego. Soporta Kick, YouTube y Twitch
                (actualmente
                integrada Kick, faltan las demás). El usuario debe solicitar este rol y un usuario admin puede aceptar o
                rechazar la solicitud</li>
              <li><strong>Sistema de Soporte:</strong> Centro de ayuda, chat de soporte y manejo robusto de errores (En
                progreso)</li>
            </ul>
          </div>

          <!-- Terra API specific content -->
          <div class="additional-content" *ngIf="project.id === 2">
            <h3 class="content-subtitle">Funcionalidades Principales</h3>
            <ul class="features-list">
              <li><strong>Sistema de Autenticación Completo:</strong> Registro, login con email/password, autenticación
                con Google OAuth mediante Firebase, verificación de email obligatoria, recuperación de contraseña y
                refresh tokens JWT</li>
              <li><strong>Gestión de Personajes:</strong> Consulta de personajes por email o ID, visualización de
                estadísticas detalladas, gestión de almacenamiento (warehouse), skills y subclases</li>
              <li><strong>Gestión de Cuentas de Juego:</strong> Crear cuenta de juego con código de verificación por
                email, cambiar contraseña de la cuenta de juego</li>
              <li><strong>Sistema de Rankings:</strong> Top PvP (Player vs Player), Top PK (Player Killer), Top Clanes y
                estadísticas del servidor</li>
              <li><strong>Marketplace Offline:</strong> Consulta de tiendas offline del juego, búsqueda de items en
                venta,
                detalles de items y búsqueda por personaje</li>
              <li><strong>Catálogo de Items:</strong> Carga de datos de items desde XML, caché de items en memoria para
                consultas rápidas, información detallada de atributos y estadísticas</li>
              <li><strong>Sistema de Pagos Integrado:</strong> Compra de Terra Coins con PayPal y MercadoPago, múltiples
                paquetes predefinidos, webhooks automáticos para confirmación de pagos y registro completo de
                transacciones</li>
              <li><strong>Retiro de Terra Coins:</strong> Sistema de retiro de coins desde el juego, código de 6 dígitos
                enviado por email para validación, gestión de permisos de personajes para retirar coins</li>
              <li><strong>Sistema de Streaming:</strong> Gestión del rol ROLE_STREAMER, aprobación/rechazo de
                solicitudes
                por admin, integración con Kick.com API</li>
              <li><strong>Sistema de Notificaciones:</strong> Notificaciones por email con templates HTML,
                notificaciones
                en tiempo real mediante WebSocket, verificación de email, reset de password y registro de cuenta de
                juego
              </li>
              <li><strong>Patch Notes:</strong> Sistema de noticias y parches del servidor, versiones y actualizaciones
              </li>
              <li><strong>Seguridad:</strong> Rate limiting con Bucket4j para prevenir abuso, Spring Security con
                control
                de acceso basado en roles (ROLE_USER, ROLE_ADMIN, ROLE_STREAMER), logging de actividad reciente para
                auditoría, entidades inmutables del juego para proteger integridad de datos</li>
            </ul>
          </div>

          <!-- Game Launcher specific content -->
          <div class="additional-content" *ngIf="project.id === 3">
            <h3 class="content-subtitle">Funcionalidades Principales</h3>
            <ul class="features-list">
              <li><strong>Descarga y Actualización de Parches:</strong> Sistema completo con progreso en tiempo real, velocidad de descarga y tiempo restante. Validación de archivos mediante checksums MD5.</li>
              <li><strong>Rankings PvP en Tiempo Real:</strong> Top PK (Player Killer), Top PvP (Player vs Player) y Top Clanes con estadísticas actualizadas del servidor.</li>
              <li><strong>Patch Notes Dinámicos:</strong> Sistema de actualizaciones con visualización de notas de parche ordenadas por fecha (más nuevas/más antiguas).</li>
              <li><strong>Validación de Cliente L2:</strong> Detección automática de la estructura del juego (system/L2.exe) y verificación de archivos esenciales.</li>
              <li><strong>Sistema de Reparación:</strong> Utilidades avanzadas para reparar archivos corruptos, limpieza de temporales y restauración de componentes críticos.</li>
              <li><strong>Ventana Moderna sin Marco:</strong> Interfaz borderless con System Tray, minimización a bandeja y splash screen animado de inicio.</li>
              <li><strong>Estadísticas del Servidor:</strong> Visualización en tiempo real de jugadores online y estadísticas generales del servidor.</li>
              <li><strong>Integración con Web:</strong> Acceso directo a sitio web, foro y recursos externos del servidor.</li>
            </ul>
          </div>

          <div class="additional-content" *ngIf="project.id === 4">
            <h3 class="content-subtitle">Funcionalidades Principales</h3>
            <ul class="features-list">
              <li><strong>Terra Market (Community Board):</strong> Market integrado donde los jugadores pueden comprar y
                vender items utilizando Terra Coin como moneda dentro de la community board. Cada personaje puede poner
                hasta <strong>10 items</strong> a la venta con <strong>10% de comisión</strong>. Si la cuenta es
                <strong>Premium</strong>, el límite aumenta a <strong>20 items</strong> con <strong>5% de comisión</strong>.</li>
              <li><strong>Buffer (Community Board):</strong> Sistema de buffs con 2 listas separadas: <strong>Beta</strong>
                (con todos los buffs del juego) y <strong>Oficial</strong> (buffs básicos de bajo nivel), pensado para
                balancear la progresión y el early game.</li>
              <li><strong>Sistema de Skins (Community Board):</strong> Armaduras cosméticas equipables que no otorgan
                estadísticas ni ventajas. Sobreescriben únicamente el aspecto visual del personaje, reemplazando el
                visual de la armadura real equipada.</li>
              <li><strong>Cuenta Premium:</strong> La cuenta que alberga al personaje puede marcarse como <strong>Premium</strong>
                para habilitar beneficios dentro del servidor, incluyendo mejoras en Terra Market (más slots y menor
                comisión) y bonificaciones de <strong>experiencia</strong> y <strong>drops</strong>.</li>
              <li><strong>Extracción de Terra Coins (Web → Juego):</strong> Retiro de coins compradas en la web mediante
                un código de 6 dígitos solicitado por el usuario (ya autenticado). El personaje debe tener permisos
                habilitados desde la web para poder extraerlas y, al completarse el proceso, se crea el item Terra Coin
                dentro del juego.</li>
              <li><strong>Sistema de Venganza (Revenge):</strong> Al morir por PvP se crea un registro de venganza con
                duración de 6 horas. Durante ese período, la víctima puede pagar Terra Coins (con costos acumulables)
                para teletransportarse a la ubicación de su asesino o para visualizar su localización. Al completar la
                venganza o al expirar el tiempo, el registro se elimina automáticamente.</li>
            </ul>

            <h3 class="content-subtitle">Items Personalizados</h3>
            <p class="development-process">
              Actualmente solo creé estos 3 items: <strong>Auto Pick Rune</strong>, que permite que
              el personaje que posea el item no tenga que acercarse al mob que mató para juntar los drops: los items van
              directo al inventario.
            </p>
            <ul class="features-list">
              <li><strong>Auto Pick Rune (7 días):</strong> Auto loot habilitado por 7 días</li>
              <li><strong>Auto Pick Rune (15 días):</strong> Auto loot habilitado por 15 días</li>
              <li><strong>Auto Pick Rune (31 días):</strong> Auto loot habilitado por 31 días</li>
            </ul>

            <p class="development-process">
              El comportamiento del auto loot varía según el tipo de party (Finder's Keeper, Random, By Turn, etc.) y
              requiere que la mayoría del party posea la rune para activarse. En raids y sus minions, los items siempre caen al suelo.
            </p>
          </div>

          <!-- Default content for other projects -->
          <div class="additional-content" *ngIf="project.id !== 1 && project.id !== 2 && project.id !== 3 && project.id !== 4">
          </div>
        </div>

        <!-- Project Links -->
        <div class="project-links-card">
          <h2 class="section-title">Enlaces del Proyecto</h2>
          <div class="project-links">
            <a *ngIf="project.github" [href]="project.github" target="_blank" class="project-link github">
              <i class="fab fa-github"></i> Ver en GitHub
            </a>
            <a *ngIf="project.demo" [href]="project.demo" target="_blank" class="project-link demo">
              <i class="fas fa-external-link-alt"></i> Ver Demo
            </a>
          </div>

          <!-- Stack Tecnológico -->
          <div class="tech-stack-section" *ngIf="project.id === 1">
            <h3 class="tech-stack-title">Stack Tecnológico</h3>
            <div class="tech-stack">
              <span class="tech-tag frontend">Angular 19.2.0</span>
              <span class="tech-tag frontend">TypeScript 5.7.2</span>
              <span class="tech-tag frontend">Bootstrap 5.3.7</span>
              <span class="tech-tag frontend">GSAP 3.13.0</span>
              <span class="tech-tag frontend">RxJS 7.8.0</span>
              <span class="tech-tag backend">Spring Boot</span>
              <span class="tech-tag security">JWT</span>
              <span class="tech-tag payment">MercadoPago SDK</span>
              <span class="tech-tag payment">PayPal API</span>
              <span class="tech-tag cloud">Firebase 11.9.1</span>
              <span class="tech-tag integration">Discord SDK</span>
              <span class="tech-tag integration">Kick.com API</span>
              <span class="tech-tag database">MySQL</span>
            </div>
          </div>

          <!-- Stack Tecnológico Terra API -->
          <div class="tech-stack-section" *ngIf="project.id === 2">
            <h3 class="tech-stack-title">Stack Tecnológico</h3>
            <div class="tech-stack">
              <span class="tech-tag backend">Java 17</span>
              <span class="tech-tag backend">Spring Boot 3.4.4</span>
              <span class="tech-tag backend">Spring Security</span>
              <span class="tech-tag backend">Spring Data JPA</span>
              <span class="tech-tag backend">Spring WebSocket</span>
              <span class="tech-tag security">JWT (jjwt 0.12.6)</span>
              <span class="tech-tag database">MariaDB</span>
              <span class="tech-tag database">Hibernate/JPA</span>
              <span class="tech-tag cloud">Firebase Admin SDK</span>
              <span class="tech-tag payment">MercadoPago SDK</span>
              <span class="tech-tag payment">PayPal SDK</span>
              <span class="tech-tag security">Bucket4j (Rate Limiting)</span>
              <span class="tech-tag integration">Resilience4j (Retry)</span>
              <span class="tech-tag integration">JavaMail</span>
              <span class="tech-tag integration">Logback</span>
            </div>
          </div>

          <!-- Stack Tecnológico Game Launcher -->
          <div class="tech-stack-section" *ngIf="project.id === 3">
            <h3 class="tech-stack-title">Stack Tecnológico</h3>
            <div class="tech-stack">
              <span class="tech-tag frontend">Electron ^28.3.3</span>
              <span class="tech-tag frontend">HTML/CSS</span>
              <span class="tech-tag frontend">Bootstrap ^5.3.5</span>
              <span class="tech-tag frontend">jQuery ^3.7.1</span>
              <span class="tech-tag frontend">FontAwesome ^6.7.2</span>
              <span class="tech-tag backend">Webpack ^5</span>
              <span class="tech-tag backend">Babel</span>
              <span class="tech-tag backend">Terser</span>
              <span class="tech-tag security">electron-builder ^26</span>
              <span class="tech-tag payment">NSIS</span>
              <span class="tech-tag cloud">Inno Setup</span>
              <span class="tech-tag integration">Windows</span>
            </div>
          </div>

          <div class="project-info">
            <div class="info-item">
              <span class="info-label">Categoría:</span>
              <span class="info-value">{{ project.category }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Tecnologías:</span>
              <span class="info-value">{{ project.tags.length }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Imágenes:</span>
              <span class="info-value">{{ project.images?.length || 0 }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Related Projects Section -->
  <section class="related-projects-section">
    <div class="container">
      <h2 class="section-title">Otros Proyectos</h2>
      <div class="related-projects">
        <div *ngFor="let relatedProject of getRelatedProjects()" class="related-project-card"
          (click)="goToProject(relatedProject.id)">
          <div class="related-project-icon">
            <fa-icon [icon]="getProjectIcon(relatedProject.id)" [style.color]="'var(--text-accent)'"></fa-icon>
          </div>
          <div class="related-project-info">
            <h3 class="related-project-title">{{ relatedProject.title }}</h3>
            <p class="related-project-category">{{ relatedProject.category }}</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="!project">
  <div class="loading-spinner"></div>
  <p>Cargando proyecto...</p>
</div>

<!-- Image Modal -->
<div class="image-modal" *ngIf="isModalOpen" (click)="onModalClick($event)">
  <div class="modal-content">
    <button class="modal-close" (click)="closeModal()">×</button>
    <div class="modal-header" *ngIf="project">
      <div class="modal-image-counter" *ngIf="project.images && project.images.length > 1">
        {{ currentImageIndex + 1 }} / {{ project.images.length }}
      </div>
      <h3>{{ project.title }}</h3>
    </div>
    <div class="modal-image-container">
      <!-- Navigation arrows -->
      <button class="modal-arrow modal-arrow-prev" *ngIf="project && project.images && project.images.length > 1"
        (click)="prevImageModal(); $event.stopPropagation()">
        ‹
      </button>
      <img [src]="selectedImage" [alt]="project?.title" class="modal-image">
      <button class="modal-arrow modal-arrow-next" *ngIf="project && project.images && project.images.length > 1"
        (click)="nextImageModal(); $event.stopPropagation()">
        ›
      </button>
    </div>
  </div>
</div>