@if (loading) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Cargando proyecto...</p>
  </div>
} @else if (error) {
  <div class="error-container">
    <p>{{ error }}</p>
    <button type="button" (click)="goBack()">Volver a Proyectos</button>
  </div>
} @else if (project) {

<div class="project-detail-container" [@fadeInUp]>
  <header class="project-nav">
    <div class="container">
      <button class="back-button" (click)="goBack()">
        <i class="fas fa-arrow-left"></i> Volver a Proyectos
      </button>
    </div>
  </header>

  <section class="project-hero">
    <div class="container">
      <div class="project-hero-layout">
        <div class="project-hero-info-col">
          <span class="category-badge">{{ project.category }}</span>
          <h1 class="project-title">{{ project.title }}</h1>
          @if (project.stacks && project.stacks.length > 0) {
            <div class="project-hero-stacks">
              @for (s of project.stacks; track s) {
                <span class="stack-pill">{{ s }}</span>
              }
            </div>
          }
        </div>
        @if (project.images && project.images.length > 0) {
          <div class="project-hero-carousel-col">
            <div class="carousel-wrapper">
              <div class="image-carousel">
                <div class="carousel-container">
                  <img [src]="getCurrentImage()" [alt]="project.title" class="project-image-large"
                    (click)="openModal(); $event.preventDefault()"
                    (mouseenter)="pauseCarousel()" (mouseleave)="resumeCarousel()">
                  @if (project.images.length > 1) {
                    <div class="image-counter">{{ currentImageIndex + 1 }} / {{ project.images.length }}</div>
                  }
                </div>
                @if (project.images.length > 1) {
                  <button class="carousel-arrow carousel-prev" (click)="prevImage()">‹</button>
                  <button class="carousel-arrow carousel-next" (click)="nextImage()">›</button>
                  <div class="carousel-indicators">
                    @for (image of project.images; track $index) {
                      <span class="indicator" [class.active]="$index === currentImageIndex" (click)="goToImage($index)"></span>
                    }
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </section>

  <section class="project-content-section">
    <div class="container">
      <div class="project-content-grid">
        <div class="project-description-col">
          <div class="description-wrapper">
            <div class="section-title-row">
              <h2 class="section-title-accent">
                <span class="section-title-line"></span>
                Descripción del Proyecto
              </h2>
              @if (isAdmin() && project) {
                <a [routerLink]="['/dashboard/projects', project.id]" class="edit-project-button">
                  <i class="fas fa-edit"></i> Editar proyecto
                </a>
              }
            </div>
            <div class="project-description project-description-scroll" [innerHTML]="getSafeHtml(project.description)"></div>

            @if (project.features && project.features.trim()) {
              <div class="additional-content">
                <h3 class="content-subtitle">Funcionalidades Principales</h3>
                <div class="features-content" [innerHTML]="getSafeHtml(project.features)"></div>
              </div>
            }
          </div>
        </div>

        <div class="project-sidebar">
          <div class="sidebar-panel">
            <h4 class="sidebar-panel-title">Enlaces del Proyecto</h4>
            <div class="project-links">
              @if (project.github) {
                <a [href]="project.github" target="_blank" rel="noopener" class="project-link-btn github" (click)="onProjectLinkClick('github')">
                  <span class="link-content"><i class="fab fa-github"></i> Ver en GitHub</span>
                  <i class="fas fa-external-link-alt"></i>
                </a>
              }
              @if (project.demo) {
                <a [href]="project.demo" target="_blank" rel="noopener" class="project-link-btn demo" (click)="onProjectLinkClick('demo')">
                  <span class="link-content"><i class="fas fa-rocket"></i> Demo en Vivo</span>
                  <i class="fas fa-external-link-alt"></i>
                </a>
              }
            </div>
          </div>

          @if (project.stacks && project.stacks.length > 0) {
            <div class="sidebar-panel">
              <h4 class="sidebar-panel-title">Stack Tecnológico</h4>
              <div class="tech-stack">
                @for (s of project.stacks; track s) {
                  <span class="tech-tag">{{ s }}</span>
                }
              </div>
            </div>
          }

          <div class="sidebar-panel">
            <h4 class="sidebar-panel-title">Info General</h4>
            <div class="project-info">
              <div class="info-item">
                <span class="info-label">Categoría</span>
                <span class="info-value">{{ project.category }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Tecnologías</span>
                <span class="info-value">{{ (project.tags || []).length }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Imágenes</span>
                <span class="info-value">{{ (project.images || []).length }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  @if (relatedProjects.length > 0) {
    <section class="related-projects-section">
      <div class="container">
        <h2 class="section-title-accent">
          <span class="section-title-line"></span>
          Otros Proyectos
        </h2>
        <div class="related-projects-grid">
          @for (relatedProject of relatedProjects; track relatedProject.id) {
            <div class="related-project-card" (click)="goToProject(relatedProject.id)">
              <div class="related-project-icon-box">
                <fa-icon [icon]="getProjectIcon(relatedProject)" class="related-project-icon"></fa-icon>
              </div>
              <p class="related-project-category">{{ relatedProject.category }}</p>
              <h3 class="related-project-title">{{ relatedProject.title }}</h3>
              <div class="related-project-action">
                Ver Detalles
                <i class="fas fa-arrow-right"></i>
              </div>
            </div>
          }
        </div>
      </div>
    </section>
  }
</div>

}

@if (isModalOpen) {
  <div class="image-modal" (click)="onModalClick($event)">
    <div class="modal-content">
      <button class="modal-close" (click)="closeModal()">×</button>
      @if (project) {
        <div class="modal-header">
          @if (project.images && project.images.length > 1) {
            <div class="modal-image-counter">{{ currentImageIndex + 1 }} / {{ project.images.length }}</div>
          }
          <h3>{{ project.title }}</h3>
        </div>
      }
      <div class="modal-image-container">
        @if (project && project.images && project.images.length > 1) {
          <button class="modal-arrow modal-arrow-prev" (click)="prevImageModal(); $event.stopPropagation()">‹</button>
        }
        <img [src]="selectedImage" [alt]="project?.title" class="modal-image">
        @if (project && project.images && project.images.length > 1) {
          <button class="modal-arrow modal-arrow-next" (click)="nextImageModal(); $event.stopPropagation()">›</button>
        }
      </div>
    </div>
  </div>
}
