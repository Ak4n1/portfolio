<section class="auth-page">
  <div class="auth-container">
    <h2 class="auth-title">Recuperar Contraseña</h2>

    @if (success) {
    <div class="auth-message-container">
      <p class="auth-success">Se ha enviado un email a <strong>{{ submittedEmail }}</strong></p>
      <p class="auth-hint">Revisa tu bandeja de entrada y spam. El enlace expira en 15 minutos.</p>
      <div class="auth-actions centered">
        <a routerLink="/login" class="btn-submit">Volver a Iniciar Sesión</a>
      </div>
    </div>
    } @else {
    <p class="auth-message">Ingresa tu email y te enviaremos las instrucciones para restablecer tu contraseña.</p>

    @if (errorMessage) {
    <p class="auth-error">{{ errorMessage }}</p>
    @if (errorMessage.includes('verificado')) {
    <button type="button" class="btn-secondary" (click)="goToResendVerification()">
      Reenviar Email de Verificación
    </button>
    }
    }

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="email">Email</label>
        <div class="input-with-icon">
          <i class="fas fa-envelope input-icon"></i>
          <input id="email" type="email" formControlName="email" placeholder="tu@email.com"
            [class.error]="isFieldInvalid('email')" autocomplete="username email" />
        </div>
        <span class="error-msg" *ngIf="isFieldInvalid('email')">Email válido requerido</span>
      </div>
      <div class="auth-actions">
        <button type="submit" class="btn-submit" [disabled]="form.invalid || isSubmitting">
          {{ isSubmitting ? 'Enviando...' : 'Enviar Instrucciones' }}
        </button>
      </div>
    </form>
    }
  </div>
</section>
