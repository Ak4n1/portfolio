<section class="projects-hero">
  <div class="hero-decor hero-decor-left"></div>
  <div class="hero-decor hero-decor-right"></div>
  <div class="container hero-content">
    <h1 class="projects-title">Mis <span class="title-accent">Proyectos</span></h1>
    <p class="projects-subtitle">Una muestra de mi trabajo y habilidades en desarrollo web</p>
  </div>
</section>

<section class="projects-filter" *ngIf="!loading && !error">
  <div class="container">
    <div class="filter-buttons">
      <button 
        *ngFor="let category of categories" 
        [class.active]="selectedCategory === category"
        (click)="filterProjects(category)"
        class="filter-btn">
        {{ category }}
      </button>
    </div>
  </div>
</section>

@if (loading) {
  <section class="projects-loading">
    <div class="container">
      <div class="loading-spinner"></div>
      <p>Loading projects...</p>
    </div>
  </section>
} @else if (error) {
  <section class="projects-error">
    <div class="container">
      <p>{{ error }}</p>
    </div>
  </section>
} @else {

<section class="projects-grid">
  <div class="container">
    <div class="projects-container">
      <article 
        *ngFor="let project of filteredProjects" 
        class="project-card"
        [@fadeInUp]>
        <div class="project-image">
          <!-- Carousel for projects with images -->
          <div class="image-carousel" *ngIf="getProjectImageUrls(project).length > 0">
            <div class="carousel-container">
              <img 
                [src]="getCurrentImage(project.id)" 
                [alt]="project.title" 
                class="project-image-real"
                (click)="openModal(project)"
                (mouseenter)="pauseCarousel(project.id)"
                (mouseleave)="resumeCarousel(project.id)">
              
              <div class="image-overlay"></div>
              
              <!-- Image counter -->
              <div class="image-counter" *ngIf="getProjectImageUrls(project).length > 1">
                {{ getCurrentIndex(project.id) + 1 }} / {{ getProjectImageUrls(project).length }}
              </div>
            </div>
            
            <button 
              class="carousel-arrow carousel-prev" 
              *ngIf="getProjectImageUrls(project).length > 1" 
              (click)="prevImage(project.id)">
              ‹
            </button>
            <button 
              class="carousel-arrow carousel-next" 
              *ngIf="getProjectImageUrls(project).length > 1" 
              (click)="nextImage(project.id)">
              ›
            </button>
            
            <div class="carousel-indicators" *ngIf="getProjectImageUrls(project).length > 1">
              <span 
                class="indicator" 
                *ngFor="let image of getProjectImageUrls(project); let i = index" 
                [class.active]="i === getCurrentIndex(project.id)"
                (click)="goToImage(project.id, i)">
              </span>
            </div>
          </div>
          
          <div class="image-placeholder" *ngIf="getProjectImageUrls(project).length === 0">
            <i [class]="getCategoryIcon(project.category)" class="project-icon-fa" aria-hidden="true"></i>
          </div>
        </div>
        
        <div class="project-content">
          <div class="project-tags">
            <span 
              *ngFor="let tag of project.tags; let i = index" 
              class="tag"
              [class.tag-accent]="i % 2 === 1">
              {{ tag }}
            </span>
          </div>
          <div class="project-title-row">
            <h3 class="project-title">{{ project.title }}</h3>
            <span class="project-likes">
              {{ project.likesCount || 0 }}
              <i class="fas fa-heart" aria-hidden="true"></i>
            </span>
          </div>
          <p class="project-description">{{ getCardDescription(project) }}</p>
          <div class="project-actions">
            <div class="project-links">
              <a 
                *ngIf="project.github" 
                [href]="project.github" 
                target="_blank" 
                rel="noopener"
                class="project-link-icon github"
                (click)="onProjectGithubClick(project); $event.stopPropagation()">
                <i class="fab fa-github"></i>
              </a>
              <a 
                *ngIf="project.demo" 
                [href]="project.demo" 
                target="_blank" 
                rel="noopener"
                class="project-link-icon demo"
                (click)="onProjectDemoClick(project); $event.stopPropagation()">
                <i class="fas fa-external-link-alt"></i>
              </a>
            </div>
            <a 
              [routerLink]="['/project', project.id]" 
              class="btn-view-more"
              (click)="onProjectCardClick(project)">
              Ver más
            </a>
          </div>
        </div>
      </article>
    </div>
  </div>
</section>

}

<section class="cta-section">
  <div class="cta-gradient-line"></div>
  <div class="container">
    <div class="cta-content">
      <h2>¿Te gusta lo que <span class="cta-accent">ves</span>?</h2>
      <p>Estoy siempre abierto a nuevos proyectos y colaboraciones interesantes.</p>
      <a routerLink="/contact" class="btn btn-primary" (click)="onCtaContactClick()">Contactar</a>
    </div>
  </div>
</section>

<app-image-lightbox
  [visible]="isModalOpen"
  [images]="lightboxImages"
  [title]="selectedProject?.title || ''"
  [startIndex]="lightboxStartIndex"
  (closed)="closeModal()"
  (indexChanged)="onLightboxIndexChanged($event)" />
