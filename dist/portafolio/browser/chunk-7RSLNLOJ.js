import{a as be}from"./chunk-DUMPRXW5.js";import{a as _e}from"./chunk-R62OSLC5.js";import{b as ee,c as te,d as h,e as ne,f as ie,k as oe,l as re,m as ae,n as se,o as le,p as ce,q as de,r as me,s as pe,v as ue,x as ge}from"./chunk-J666E7JD.js";import{a as V}from"./chunk-MQB6D6E4.js";import{b as Z,d as T}from"./chunk-SFS47BZX.js";import{q as X,s as D}from"./chunk-XPIPXS6X.js";import{Ab as _,D as K,Eb as y,Ib as m,Jb as c,Rb as r,Sb as b,Ta as W,Tb as P,U as w,Ua as l,Ub as H,_ as f,bc as E,cb as I,dc as M,fa as p,ga as u,hb as v,ob as Y,pb as x,pc as R,q,qb as L,rb as O,ta as Q,tb as C,ua as d,ub as U,v as G,vb as J,wb as S,xb as k,yb as i,zb as n}from"./chunk-PWGBBCAH.js";var j=class o{http=f(T);apiUrl=`${V.apiBaseUrl}/api/admin/chatbot-config`;getConfig(){return this.http.get(this.apiUrl)}getPublicProjectOptions(){return this.http.get(`${this.apiUrl}/public-projects`)}updateConfig(t){return this.http.put(this.apiUrl,t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var N=class o{http=f(T);usageApiUrl=`${V.apiBaseUrl}/api/admin/chatbot-config/openrouter-usage`;getUsage(){return this.http.get(this.usageApiUrl).pipe(G(t=>this.normalize(t)),K(t=>q(()=>this.toUserError(t))))}normalize(t){let e=t.data??t;return{limit:this.toNumber(e.limit),limitRemaining:this.toNumber(e.limit_remaining),usage:this.toNumber(e.usage),usageDaily:this.toNumber(e.usage_daily),usageWeekly:this.toNumber(e.usage_weekly),usageMonthly:this.toNumber(e.usage_monthly),isFreeTier:!!e.is_free_tier}}toNumber(t){if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="string"){let e=Number(t);if(Number.isFinite(e))return e}return 0}toUserError(t){if(t.status===401)return new Error("No autorizado para consultar OpenRouter (401). Revisa la API key en backend.");if(t.status===429)return new Error("OpenRouter rate limit alcanzado (429). Espera un momento e intenta de nuevo.");if(t.status===0)return new Error("No se pudo conectar al backend para consultar OpenRouter.");let e=typeof t.error?.message=="string"&&t.error.message.trim()?t.error.message.trim():null;return new Error(e??`No se pudo obtener uso de OpenRouter (${t.status}).`)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};function ve(o,t){if(o&1&&(i(0,"div",5)(1,"article",6)(2,"span",7),r(3,"Creditos totales"),n(),i(4,"strong"),r(5),E(6,"number"),n()(),i(7,"article",6)(8,"span",7),r(9,"Creditos restantes"),n(),i(10,"strong"),r(11),E(12,"number"),n(),i(13,"small"),r(14),n()(),i(15,"article",6)(16,"span",7),r(17,"Uso total acumulado"),n(),i(18,"strong"),r(19),E(20,"number"),n()(),i(21,"article",6)(22,"span",7),r(23,"Tipo de cuenta"),n(),i(24,"span",8),r(25),n()()(),i(26,"div",9)(27,"div",10)(28,"div",11)(29,"span"),r(30,"Uso diario"),n(),i(31,"strong"),r(32),E(33,"number"),n()(),i(34,"div",12),_(35,"div",13),n(),i(36,"small"),r(37),n()(),i(38,"div",10)(39,"div",11)(40,"span"),r(41,"Uso semanal"),n(),i(42,"strong"),r(43),E(44,"number"),n()()(),i(45,"div",10)(46,"div",11)(47,"span"),r(48,"Uso mensual"),n(),i(49,"strong"),r(50),E(51,"number"),n()(),i(52,"div",12),_(53,"div",14),n(),i(54,"small"),r(55),n()()()),o&2){let e=t,a=c();l(5),b(M(6,22,e.limit,"1.0-2")),l(2),O("low",a.hasLowRemaining()),l(4),b(M(12,25,e.limitRemaining,"1.0-2")),l(2),O("low",a.hasLowRemaining()),l(),P("Disponible ",a.remainingPercent(),"%"),l(5),b(M(20,28,e.usage,"1.0-2")),l(5),O("free",e.isFreeTier)("paid",!e.isFreeTier),l(),P(" ",e.isFreeTier?"Free Tier":"Creditos pagos"," "),l(7),b(M(33,31,e.usageDaily,"1.0-2")),l(3),L("width",a.usageDailyPercent(),"%"),l(2),P("",a.usageDailyPercent(),"% del limite"),l(6),b(M(44,34,e.usageWeekly,"1.0-2")),l(7),b(M(51,37,e.usageMonthly,"1.0-2")),l(3),L("width",a.usageMonthlyPercent(),"%"),l(2),P("",a.usageMonthlyPercent(),"% del limite")}}function xe(o,t){o&1&&(i(0,"div",3),_(1,"div",15),i(2,"p"),r(3,"Cargando datos de OpenRouter..."),n()())}function ye(o,t){if(o&1){let e=y();i(0,"div",4)(1,"p"),r(2),n(),i(3,"button",16),m("click",function(){p(e);let s=c();return u(s.loadUsage())}),r(4,"Reintentar"),n()()}if(o&2){let e=c();l(2),b(e.error())}}var F=class o{openRouterService=f(N);AUTO_REFRESH_MS=6e4;usage=d(null);loading=d(!0);refreshing=d(!1);error=d(null);autoRefreshId=null;hasLowRemaining=R(()=>{let t=this.usage();return!t||t.limit<=0?!1:t.limitRemaining/t.limit<.2});remainingPercent=R(()=>{let t=this.usage();return!t||t.limit<=0?0:this.toPercent(t.limitRemaining,t.limit)});usageDailyPercent=R(()=>{let t=this.usage();return!t||t.limit<=0?0:this.toPercent(t.usageDaily,t.limit)});usageMonthlyPercent=R(()=>{let t=this.usage();return!t||t.limit<=0?0:this.toPercent(t.usageMonthly,t.limit)});ngOnInit(){this.loadUsage()}ngOnDestroy(){this.stopAutoRefresh()}loadUsage(){this.loading.set(!0),this.error.set(null),this.openRouterService.getUsage().subscribe({next:t=>{this.usage.set(t),this.loading.set(!1)},error:t=>{this.error.set(t.message),this.loading.set(!1)}})}refresh(){this.loading()||this.refreshing()||(this.refreshing.set(!0),this.error.set(null),this.openRouterService.getUsage().subscribe({next:t=>{this.usage.set(t),this.refreshing.set(!1)},error:t=>{this.error.set(t.message),this.refreshing.set(!1)}}))}startAutoRefresh(){this.stopAutoRefresh(),this.autoRefreshId=setInterval(()=>this.refresh(),this.AUTO_REFRESH_MS)}stopAutoRefresh(){this.autoRefreshId&&(clearInterval(this.autoRefreshId),this.autoRefreshId=null)}toPercent(t,e){if(e<=0)return 0;let a=t/e*100;return Math.max(0,Math.min(100,Math.round(a)))}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-openrouter-usage"]],decls:12,vars:3,consts:[[1,"usage-panel"],[1,"usage-header"],["type","button",1,"usage-refresh",3,"click","disabled"],[1,"usage-loading"],[1,"usage-error"],[1,"usage-grid"],[1,"usage-card"],[1,"label"],[1,"tier-badge"],[1,"usage-bars"],[1,"usage-bar-card"],[1,"bar-header"],[1,"bar-track"],[1,"bar-fill","daily"],[1,"bar-fill","monthly"],[1,"usage-spinner"],["type","button",1,"usage-refresh",3,"click"]],template:function(e,a){if(e&1&&(i(0,"section",0)(1,"header",1)(2,"div")(3,"h3"),r(4,"OpenRouter Usage"),n(),i(5,"p"),r(6,"Datos de uso obtenidos via backend proxy seguro."),n()(),i(7,"button",2),m("click",function(){return a.refresh()}),r(8),n()(),v(9,ve,56,40)(10,xe,4,0,"div",3)(11,ye,5,1,"div",4),n()),e&2){let s;l(7),x("disabled",a.loading()||a.refreshing()),l(),P(" ",a.refreshing()?"Actualizando...":"Refresh"," "),l(),C((s=a.usage())?9:a.loading()?10:a.error()?11:-1,s)}},dependencies:[D,X],styles:[".usage-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.usage-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.usage-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.usage-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0 0;color:var(--color-text-secondary);font-size:.9rem}.usage-refresh[_ngcontent-%COMP%]{border:1px solid color-mix(in srgb,var(--color-primary) 65%,transparent);background:transparent;color:var(--color-primary);border-radius:.5rem;padding:.45rem .85rem;font-weight:700;cursor:pointer}.usage-refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.usage-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.75rem}.usage-card[_ngcontent-%COMP%]{border:1px solid color-mix(in srgb,var(--color-primary) 18%,transparent);border-radius:.65rem;padding:.75rem .9rem;background:color-mix(in srgb,var(--color-primary) 5%,transparent)}.usage-card.low[_ngcontent-%COMP%]{border-color:color-mix(in srgb,#f59e0b 55%,transparent)}.usage-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;color:var(--color-text-secondary);font-size:.78rem;text-transform:uppercase;letter-spacing:.08em}.usage-card[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-top:.28rem;font-size:1.2rem}.usage-card[_ngcontent-%COMP%]   small.low[_ngcontent-%COMP%]{color:#f59e0b}.tier-badge[_ngcontent-%COMP%]{display:inline-flex;margin-top:.45rem;border-radius:999px;padding:.22rem .62rem;font-size:.75rem;font-weight:700}.tier-badge.free[_ngcontent-%COMP%]{background:color-mix(in srgb,#22c55e 20%,transparent);color:#86efac;border:1px solid color-mix(in srgb,#22c55e 55%,transparent)}.tier-badge.paid[_ngcontent-%COMP%]{background:color-mix(in srgb,#3b82f6 20%,transparent);color:#93c5fd;border:1px solid color-mix(in srgb,#3b82f6 55%,transparent)}.usage-bars[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.7rem}.usage-bar-card[_ngcontent-%COMP%]{border:1px solid color-mix(in srgb,var(--color-primary) 18%,transparent);border-radius:.65rem;padding:.75rem .9rem;background:color-mix(in srgb,var(--color-primary) 5%,transparent)}.bar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.bar-track[_ngcontent-%COMP%]{width:100%;height:10px;border-radius:999px;background:color-mix(in srgb,var(--color-text-primary) 18%,transparent);margin-top:.55rem;overflow:hidden}.bar-fill[_ngcontent-%COMP%]{height:100%;border-radius:999px;transition:width .3s ease}.bar-fill.daily[_ngcontent-%COMP%]{background:linear-gradient(90deg,#10b981,#34d399)}.bar-fill.monthly[_ngcontent-%COMP%]{background:linear-gradient(90deg,#3b82f6,#60a5fa)}.usage-loading[_ngcontent-%COMP%], .usage-error[_ngcontent-%COMP%]{border:1px dashed color-mix(in srgb,var(--color-primary) 25%,transparent);border-radius:.65rem;padding:1.1rem;text-align:center;color:var(--color-text-secondary)}.usage-spinner[_ngcontent-%COMP%]{width:28px;height:28px;margin:0 auto .6rem;border:3px solid color-mix(in srgb,var(--color-primary) 22%,transparent);border-top-color:var(--color-primary);border-radius:50%;animation:_ngcontent-%COMP%_usageSpin .9s linear infinite}@media (max-width: 760px){.usage-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.usage-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}@keyframes _ngcontent-%COMP%_usageSpin{to{transform:rotate(360deg)}}"]})};var z=class o{http=f(T);baseUrl=`${V.apiBaseUrl}/api/admin/chatbot-config/audit`;getConversationsByUser(t){let e=new Z().set("userId",String(t.userId)).set("page",String(t.page??0)).set("size",String(t.size??20));return this.http.get(`${this.baseUrl}/conversations`,{params:e})}getConversationDetail(t){return this.http.get(`${this.baseUrl}/conversations/${t}`)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var Pe=(o,t)=>t.id,Oe=(o,t)=>t.conversationId;function Se(o,t){if(o&1&&(i(0,"p",5),r(1),n()),o&2){let e=c();l(),b(e.userSearchError())}}function ke(o,t){if(o&1){let e=y();i(0,"button",13),m("click",function(){let s=p(e).$implicit,g=c();return u(g.selectUser(s))}),i(1,"span",14),r(2),n(),i(3,"span",15),r(4),n()()}if(o&2){let e,a=t.$implicit,s=c();O("active",((e=s.selectedUser())==null?null:e.id)===a.id),l(2),b(s.getUserDisplayName(a)),l(2),b(a.email)}}function Ee(o,t){o&1&&(i(0,"p",10),r(1,"Sin resultados."),n())}function Me(o,t){o&1&&(i(0,"p",10),r(1,"Cargando conversaciones..."),n())}function we(o,t){if(o&1&&(i(0,"p",5),r(1),n()),o&2){let e=c();l(),b(e.conversationsError())}}function Ie(o,t){if(o&1){let e=y();i(0,"button",13),m("click",function(){let s=p(e).$implicit,g=c(2);return u(g.selectConversation(s))}),i(1,"span",14),r(2),n(),i(3,"span",15),r(4),n(),i(5,"span",15),r(6),n()()}if(o&2){let e=t.$implicit,a=c(2);O("active",a.selectedConversationId()===e.conversationId),l(2),b(e.preview),l(2),H(" ",e.provider," / ",e.model," "),l(2),b(a.formatDate(e.updatedAt))}}function De(o,t){o&1&&(i(0,"p",10),r(1,"Este usuario no tiene conversaciones auditadas."),n())}function Te(o,t){if(o&1&&(i(0,"div",8),S(1,Ie,7,6,"button",9,Oe,!1,De,2,0,"p",10),n()),o&2){let e=c();l(),k(e.conversations())}}function Ve(o,t){o&1&&(i(0,"p",10),r(1,"Cargando detalle..."),n())}function Re(o,t){if(o&1&&(i(0,"p",5),r(1),n()),o&2){let e=c();l(),b(e.conversationDetailError())}}function Ae(o,t){if(o&1&&(i(0,"article",19)(1,"header")(2,"strong"),r(3),n(),i(4,"span"),r(5),n()(),i(6,"p"),r(7),n()()),o&2){let e=t.$implicit,a=c(2);O("user",e.role==="user")("assistant",e.role==="assistant"),l(3),b(e.role==="user"?"Usuario":"Asistente"),l(2),b(a.formatDate(e.createdAt)),l(2),b(e.content)}}function Ue(o,t){if(o&1&&(i(0,"div",16)(1,"span")(2,"strong"),r(3,"Usuario:"),n(),r(4),n(),i(5,"span")(6,"strong"),r(7,"Email:"),n(),r(8),n(),i(9,"span")(10,"strong"),r(11,"Proveedor:"),n(),r(12),n(),i(13,"span")(14,"strong"),r(15,"Fecha:"),n(),r(16),n()(),i(17,"div",17),S(18,Ae,8,7,"article",18,U),n()),o&2){let e=c();l(4),P(" ",e.conversationDetail().user.fullName,""),l(4),P(" ",e.conversationDetail().user.email,""),l(4),H(" ",e.conversationDetail().provider," / ",e.conversationDetail().model,""),l(4),P(" ",e.formatDate(e.conversationDetail().updatedAt),""),l(2),k(e.conversationDetail().messages)}}function je(o,t){o&1&&(i(0,"p",10),r(1,"Selecciona una conversacion para ver los mensajes."),n())}var $=class o{adminUserService=f(_e);chatbotAuditService=f(z);query=d("");searchingUsers=d(!1);userSearchError=d(null);users=d([]);selectedUser=d(null);loadingConversations=d(!1);conversationsError=d(null);conversations=d([]);selectedConversationId=d(null);loadingConversationDetail=d(!1);conversationDetailError=d(null);conversationDetail=d(null);setQuery(t){this.query.set(t)}searchUsers(){let t=this.query().trim();if(t.length<2){this.users.set([]),this.userSearchError.set("Escribe al menos 2 caracteres para buscar usuarios.");return}this.searchingUsers.set(!0),this.userSearchError.set(null),this.users.set([]),this.adminUserService.searchUsers({query:t,limit:15}).subscribe({next:e=>{this.users.set(e??[]),this.searchingUsers.set(!1)},error:()=>{this.searchingUsers.set(!1),this.userSearchError.set("No se pudo buscar usuarios.")}})}selectUser(t){this.selectedUser.set(t),this.selectedConversationId.set(null),this.conversationDetail.set(null),this.conversationDetailError.set(null),this.loadConversations(t.id)}selectConversation(t){this.selectedConversationId.set(t.conversationId),this.conversationDetail.set(null),this.conversationDetailError.set(null),this.loadingConversationDetail.set(!0),this.chatbotAuditService.getConversationDetail(t.conversationId).subscribe({next:e=>{this.conversationDetail.set(e),this.loadingConversationDetail.set(!1)},error:()=>{this.loadingConversationDetail.set(!1),this.conversationDetailError.set("No se pudo cargar el detalle de la conversacion.")}})}formatDate(t){return t?new Intl.DateTimeFormat("es-AR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(t)):"-"}getUserDisplayName(t){let e=t.firstName?.trim()??"",a=t.lastName?.trim()??"";return`${e} ${a}`.trim()||t.email}loadConversations(t){this.loadingConversations.set(!0),this.conversationsError.set(null),this.conversations.set([]),this.chatbotAuditService.getConversationsByUser({userId:t,page:0,size:50}).subscribe({next:e=>{this.conversations.set(e.items??[]),this.loadingConversations.set(!1)},error:()=>{this.loadingConversations.set(!1),this.conversationsError.set("No se pudieron cargar las conversaciones de este usuario.")}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-chatbot-audit"]],decls:32,vars:7,consts:[[1,"audit-card"],[1,"audit-header"],[1,"audit-user-search"],["placeholder","Buscar usuario por nombre o email...",1,"audit-input",3,"input","keydown.enter","value"],["type","button",1,"audit-btn",3,"click","disabled"],[1,"audit-error"],[1,"audit-layout"],[1,"audit-column","audit-users"],[1,"audit-list"],["type","button",1,"audit-list-item",3,"active"],[1,"audit-muted"],[1,"audit-column","audit-conversations"],[1,"audit-column","audit-detail"],["type","button",1,"audit-list-item",3,"click"],[1,"audit-item-title"],[1,"audit-item-sub"],[1,"audit-detail-meta"],[1,"audit-messages"],[1,"audit-message",3,"user","assistant"],[1,"audit-message"]],template:function(e,a){e&1&&(i(0,"section",0)(1,"header",1)(2,"h2"),r(3,"Auditoria de Chat"),n(),i(4,"p"),r(5,"Busca un usuario, selecciona una conversacion y revisa mensajes."),n()(),i(6,"div",2)(7,"input",3),m("input",function(g){return a.setQuery(g.target.value)})("keydown.enter",function(){return a.searchUsers()}),n(),i(8,"button",4),m("click",function(){return a.searchUsers()}),r(9),n()(),v(10,Se,2,1,"p",5),i(11,"div",6)(12,"aside",7)(13,"h3"),r(14,"Usuarios"),n(),i(15,"div",8),S(16,ke,5,4,"button",9,Pe,!1,Ee,2,0,"p",10),n()(),i(19,"aside",11)(20,"h3"),r(21,"Conversaciones"),n(),v(22,Me,2,0,"p",10)(23,we,2,1,"p",5)(24,Te,4,1,"div",8),n(),i(25,"section",12)(26,"h3"),r(27,"Detalle"),n(),v(28,Ve,2,0,"p",10)(29,Re,2,1,"p",5)(30,Ue,20,5)(31,je,2,0,"p",10),n()()()),e&2&&(l(7),x("value",a.query()),l(),x("disabled",a.searchingUsers()),l(),P(" ",a.searchingUsers()?"Buscando...":"Buscar"," "),l(),C(a.userSearchError()?10:-1),l(6),k(a.users()),l(6),C(a.loadingConversations()?22:a.conversationsError()?23:24),l(6),C(a.loadingConversationDetail()?28:a.conversationDetailError()?29:a.conversationDetail()?30:31))},dependencies:[D],styles:[".audit-card[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-primary) 6%,var(--background-dark));border:1px solid color-mix(in srgb,var(--color-primary) 15%,transparent);border-radius:.75rem;padding:1.2rem}.audit-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.05rem}.audit-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.35rem 0 .9rem;color:var(--color-text-secondary)}.audit-user-search[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;gap:.6rem;margin-bottom:.9rem}.audit-input[_ngcontent-%COMP%]{width:100%;padding:.72rem .8rem;border-radius:.5rem;border:1px solid color-mix(in srgb,var(--color-text-primary) 22%,transparent);background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);color:var(--color-text-primary)}.audit-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary)}.audit-btn[_ngcontent-%COMP%]{border:none;border-radius:.5rem;padding:.68rem .9rem;font-weight:700;background:var(--color-primary);color:var(--color-primary-contrast, #0b1211);cursor:pointer}.audit-btn[_ngcontent-%COMP%]:disabled{opacity:.65;cursor:not-allowed}.audit-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(220px,.9fr) minmax(240px,1fr) minmax(300px,1.6fr);gap:.8rem}.audit-column[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .6rem;font-size:.9rem}.audit-list[_ngcontent-%COMP%]{border:1px solid color-mix(in srgb,var(--color-text-primary) 16%,transparent);border-radius:.5rem;background:color-mix(in srgb,var(--color-text-primary) 4%,transparent);max-height:420px;overflow-y:auto;padding:.4rem;display:flex;flex-direction:column;gap:.35rem}.audit-list-item[_ngcontent-%COMP%]{width:100%;text-align:left;border:1px solid color-mix(in srgb,var(--color-text-primary) 18%,transparent);background:color-mix(in srgb,var(--color-text-primary) 6%,transparent);color:var(--color-text-primary);border-radius:.45rem;padding:.48rem .55rem;cursor:pointer;display:flex;flex-direction:column;gap:.15rem}.audit-list-item.active[_ngcontent-%COMP%]{border-color:color-mix(in srgb,var(--color-primary) 55%,transparent);background:color-mix(in srgb,var(--color-primary) 13%,transparent)}.audit-item-title[_ngcontent-%COMP%]{font-size:.82rem;line-height:1.3}.audit-item-sub[_ngcontent-%COMP%]{font-size:.72rem;color:var(--color-text-secondary)}.audit-detail-meta[_ngcontent-%COMP%]{display:grid;gap:.3rem;margin-bottom:.65rem;font-size:.8rem}.audit-messages[_ngcontent-%COMP%]{border:1px solid color-mix(in srgb,var(--color-text-primary) 16%,transparent);border-radius:.5rem;background:color-mix(in srgb,var(--color-text-primary) 4%,transparent);max-height:420px;overflow-y:auto;padding:.55rem;display:flex;flex-direction:column;gap:.48rem}.audit-message[_ngcontent-%COMP%]{border-radius:.45rem;padding:.5rem .55rem;border:1px solid transparent}.audit-message.user[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-primary) 12%,transparent);border-color:color-mix(in srgb,var(--color-primary) 30%,transparent)}.audit-message.assistant[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-text-primary) 9%,transparent);border-color:color-mix(in srgb,var(--color-text-primary) 18%,transparent)}.audit-message[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-bottom:.22rem;font-size:.72rem;color:var(--color-text-secondary)}.audit-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;overflow-wrap:anywhere;line-height:1.35;font-size:.84rem}.audit-muted[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:.84rem}.audit-error[_ngcontent-%COMP%]{color:#f87171;font-size:.84rem}@media (max-width: 1200px){.audit-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.audit-list[_ngcontent-%COMP%], .audit-messages[_ngcontent-%COMP%]{max-height:260px}}"]})};var Ce=(o,t)=>t.value,Ne=(o,t)=>t.id;function Fe(o,t){o&1&&_(0,"app-chatbot-audit")}function ze(o,t){o&1&&(i(0,"section",7)(1,"p",9),r(2,"Cargando configuracion..."),n()())}function $e(o,t){if(o&1){let e=y();i(0,"section",7)(1,"p",10),r(2),n(),i(3,"button",11),m("click",function(){p(e);let s=c(2);return u(s.loadConfig())}),r(4,"Reintentar"),n()()}if(o&2){let e=c(2);l(2),b(e.loadError())}}function Be(o,t){if(o&1&&(i(0,"option",15),r(1),n()),o&2){let e=t.$implicit;x("value",e.value),l(),b(e.label)}}function Le(o,t){if(o&1){let e=y();i(0,"li",52),m("click",function(){let s=p(e).$implicit,g=c(3);return u(g.selectProvider(s.value))}),r(1),n()}if(o&2){let e=t.$implicit,a=c(3);O("selected",a.form.controls.activeProvider.value===e.value),l(),P(" ",e.label," ")}}function He(o,t){if(o&1&&(i(0,"p",10),r(1),n()),o&2){let e=c(3);l(),b(e.projectOptionsError())}}function qe(o,t){o&1&&(i(0,"p",9),r(1,"No hay proyectos publicos para seleccionar."),n())}function Ge(o,t){if(o&1){let e=y();i(0,"label",53)(1,"input",54),m("change",function(s){let g=p(e).$implicit,B=c(4);return u(B.toggleFocusProject(g.id,s.target.checked))}),n(),i(2,"span",55),r(3),n(),i(4,"span",56),r(5),n()()}if(o&2){let e=t.$implicit,a=c(4);l(),x("checked",a.isProjectSelected(e.id)),l(2),b(e.title),l(2),b(e.category)}}function Ke(o,t){if(o&1&&(i(0,"div",29),S(1,Ge,6,3,"label",53,Ne),n()),o&2){let e=c(3);l(),k(e.projectOptions())}}function Qe(o,t){if(o&1&&(i(0,"p",10),r(1),n()),o&2){let e=c(3);l(),b(e.saveError())}}function We(o,t){if(o&1&&(i(0,"p",35),r(1),n()),o&2){let e=c(3);l(),b(e.saveSuccess())}}function Ye(o,t){if(o&1){let e=y();i(0,"input",58),m("input",function(s){p(e);let g=c(5);return u(g.setEditingStackValue(s.target.value))})("keydown.enter",function(){p(e);let s=c().$index,g=c(4);return u(g.saveEditStack(s))}),n(),i(1,"button",59),m("click",function(){p(e);let s=c().$index,g=c(4);return u(g.saveEditStack(s))}),_(2,"i",60),n(),i(3,"button",61),m("click",function(){p(e);let s=c(5);return u(s.cancelEditStack())}),_(4,"i",62),n()}if(o&2){let e=c(5);x("value",e.editingStackValue())}}function Je(o,t){if(o&1){let e=y();i(0,"span"),r(1),n(),i(2,"button",63),m("click",function(){p(e);let s=c().$index,g=c(4);return u(g.startEditStack(s))}),_(3,"i",64),n(),i(4,"button",65),m("click",function(){p(e);let s=c().$implicit,g=c(4);return u(g.removeProfileStack(s))}),_(5,"i",66),n()}if(o&2){let e=c().$implicit;l(),b(e)}}function Xe(o,t){if(o&1&&(i(0,"div",57),v(1,Ye,5,1)(2,Je,6,1),n()),o&2){let e=t.$index,a=c(4);l(),C(a.editingStackIndex()===e?1:2)}}function Ze(o,t){if(o&1&&(i(0,"div",45),S(1,Xe,3,1,"div",57,J),n()),o&2){let e=c(3);l(),k(e.profileStacks())}}function et(o,t){o&1&&(i(0,"p",46),r(1,"Aun no definiste stacks profesionales."),n())}function tt(o,t){o&1&&(i(0,"p",9),r(1,"Aun no hay mensajes. Escribe una consulta para probar."),n())}function nt(o,t){if(o&1&&(i(0,"div",68)(1,"p"),r(2),n()()),o&2){let e=t.$implicit;O("chat-msg-user",e.role==="user")("chat-msg-assistant",e.role==="assistant"),l(2),b(e.content)}}function it(o,t){if(o&1&&S(0,nt,3,5,"div",67,U),o&2){let e=c(3);k(e.previewMessages())}}function ot(o,t){if(o&1&&(i(0,"p",10),r(1),n()),o&2){let e=c(3);l(),b(e.testError())}}function rt(o,t){if(o&1){let e=y();i(0,"div",8)(1,"section",7)(2,"h2"),r(3,"Parametros del proveedor"),n(),i(4,"form",12),m("ngSubmit",function(){p(e);let s=c(2);return u(s.save())}),i(5,"div",13)(6,"label"),r(7,"Proveedor activo"),n(),i(8,"select",14),S(9,Be,2,2,"option",15,Ce),n(),i(11,"div",16),m("click",function(s){return p(e),u(s.stopPropagation())}),i(12,"button",17),m("click",function(){p(e);let s=c(2);return u(s.toggleProviderOpen())}),i(13,"span"),r(14),n(),_(15,"i",18),n(),i(16,"ul",19),S(17,Le,2,3,"li",20,Ce),n()()(),i(19,"label",21)(20,"span"),r(21,"Chatbot habilitado"),n(),_(22,"input",22),n(),i(23,"div",23)(24,"div",13)(25,"label"),r(26,"Modelo OpenRouter"),n(),_(27,"input",24),n(),i(28,"div",13)(29,"label"),r(30,"Modelo OpenAI"),n(),_(31,"input",25),n()(),i(32,"div",23)(33,"div",13)(34,"label"),r(35,"Modelo Anthropic"),n(),_(36,"input",26),n(),i(37,"div",13)(38,"label"),r(39,"Temperatura"),n(),_(40,"input",27),n()(),i(41,"div",13)(42,"label"),r(43,"Max tokens"),n(),_(44,"input",28),n(),i(45,"div",13)(46,"label"),r(47,'Proyectos actuales (para respuestas de "en que estas trabajando")'),n(),v(48,He,2,1,"p",10)(49,qe,2,0,"p",9)(50,Ke,3,0,"div",29),n(),i(51,"div",13)(52,"label"),r(53,"Temas permitidos (CSV)"),n(),_(54,"textarea",30),n(),i(55,"div",13)(56,"label"),r(57,"Mensaje fuera de dominio"),n(),_(58,"textarea",31),n(),i(59,"div",13)(60,"div",32)(61,"label"),r(62,"System prompt"),n(),i(63,"button",33),m("click",function(){p(e);let s=c(2);return u(s.openSystemPromptModal())}),r(64," Ver completo "),n()(),_(65,"textarea",34),n(),v(66,Qe,2,1,"p",10)(67,We,2,1,"p",35),i(68,"div",36)(69,"button",37),r(70),n()()()(),i(71,"aside",38)(72,"h2"),r(73,"Ayuda y consumo"),n(),i(74,"p"),r(75,"Proveedor seleccionado: "),i(76,"strong"),r(77),n()(),i(78,"p",39),r(79,"Accede a la guia de configuracion o revisa consumo de OpenRouter."),n(),i(80,"button",40),m("click",function(){p(e);let s=c(2);return u(s.openHelpModal())}),r(81," Ver ayuda de configuracion "),n(),i(82,"button",40),m("click",function(){p(e);let s=c(2);return u(s.openOpenRouterUsageModal())}),r(83," Ver OpenRouter Usage "),n(),i(84,"div",41)(85,"h3"),r(86,"Stack profesional"),n(),i(87,"p",39),r(88,"Estos stacks se usan como contexto base del asistente."),n(),i(89,"div",42)(90,"input",43),m("input",function(s){p(e);let g=c(2);return u(g.setStackInput(s.target.value))})("keydown.enter",function(s){p(e);let g=c(2);return u(g.addProfileStack(s))}),n(),i(91,"button",44),m("click",function(s){p(e);let g=c(2);return u(g.addProfileStack(s))}),r(92,"+"),n()(),v(93,Ze,3,0,"div",45)(94,et,2,0,"p",46),n()(),i(95,"section",47)(96,"h2"),r(97,"Mini chat de prueba"),n(),i(98,"p",39),r(99,"Prueba una pregunta sin salir del panel de configuracion."),n(),i(100,"div",48),v(101,tt,2,0,"p",9)(102,it,2,0),n(),i(103,"div",49)(104,"input",50),m("input",function(s){p(e);let g=c(2);return u(g.setTestInput(s.target.value))}),n(),i(105,"button",51),m("click",function(){p(e);let s=c(2);return u(s.runPreviewChat())}),r(106),n()(),v(107,ot,2,1,"p",10),n()()}if(o&2){let e=c(2);l(4),x("formGroup",e.form),l(5),k(e.providerOptions),l(2),O("open",e.providerOpen()),l(),Y("aria-expanded",e.providerOpen()),l(2),b(e.getSelectedProviderLabel()),l(3),k(e.providerOptions),l(31),C(e.projectOptionsError()?48:e.projectOptions().length===0?49:50),l(18),C(e.saveError()?66:-1),l(),C(e.saveSuccess()?67:-1),l(2),x("disabled",e.form.invalid||e.form.pristine||e.saving()),l(),P(" ",e.saving()?"Guardando...":"Guardar configuracion"," "),l(7),b(e.getSelectedProviderLabel()),l(13),x("value",e.stackInput()),l(3),C(e.profileStacks().length>0?93:94),l(8),C(e.previewMessages().length===0?101:102),l(3),x("value",e.testInput())("disabled",e.testing()),l(),x("disabled",e.testing()||!e.testInput().trim()),l(),P(" ",e.testing()?"Probando...":"Probar"," "),l(),C(e.testError()?107:-1)}}function at(o,t){if(o&1&&v(0,ze,3,0,"section",7)(1,$e,5,1,"section",7)(2,rt,108,19,"div",8),o&2){let e=c();C(e.loading()?0:e.loadError()?1:2)}}function st(o,t){if(o&1){let e=y();i(0,"div",69),m("click",function(){p(e);let s=c();return u(s.closeOpenRouterUsageModal())}),i(1,"div",70),m("click",function(s){return p(e),u(s.stopPropagation())}),i(2,"div",71)(3,"h3"),r(4,"OpenRouter Usage"),n(),i(5,"button",72),m("click",function(){p(e);let s=c();return u(s.closeOpenRouterUsageModal())}),_(6,"i",73),n()(),i(7,"div",74),_(8,"app-openrouter-usage"),n()()()}}function lt(o,t){if(o&1){let e=y();i(0,"div",69),m("click",function(){p(e);let s=c();return u(s.closeHelpModal())}),i(1,"div",70),m("click",function(s){return p(e),u(s.stopPropagation())}),i(2,"div",71)(3,"h3"),r(4,"Ayuda de configuracion"),n(),i(5,"button",72),m("click",function(){p(e);let s=c();return u(s.closeHelpModal())}),_(6,"i",73),n()(),i(7,"div",75)(8,"ol")(9,"li"),r(10,"Guarda la nueva key en variables de entorno del backend Spring."),n(),i(11,"li"),r(12,"OpenRouter: "),i(13,"code"),r(14,"OPENROUTER_API_KEY"),n()(),i(15,"li"),r(16,"OpenAI: "),i(17,"code"),r(18,"OPENAI_API_KEY"),n()(),i(19,"li"),r(20,"Anthropic: "),i(21,"code"),r(22,"ANTHROPIC_API_KEY"),n()(),i(23,"li"),r(24,"En este panel cambia "),i(25,"code"),r(26,"activeProvider"),n(),r(27," al proveedor deseado."),n(),i(28,"li"),r(29,"Guarda la configuracion y prueba una consulta en el chat."),n()(),i(30,"p",39),r(31," No necesitas keys de OpenAI/Anthropic ahora. Puedes operar solo con OpenRouter y cambiar cuando tengas nuevas credenciales. "),n()()()()}}function ct(o,t){if(o&1){let e=y();i(0,"div",69),m("click",function(){p(e);let s=c();return u(s.closeSystemPromptModal())}),i(1,"div",70),m("click",function(s){return p(e),u(s.stopPropagation())}),i(2,"div",71)(3,"h3"),r(4,"System prompt (solo lectura)"),n(),i(5,"button",72),m("click",function(){p(e);let s=c();return u(s.closeSystemPromptModal())}),_(6,"i",73),n()(),i(7,"div",74),_(8,"textarea",76),n()()()}if(o&2){let e=c();l(8),x("value",e.form.controls.systemPrompt.value)}}var fe=class o{fb=f(ue);chatbotConfigService=f(j);chatService=f(be);elementRef=f(Q);loading=d(!0);saving=d(!1);loadError=d(null);saveError=d(null);saveSuccess=d(null);testing=d(!1);testError=d(null);testInput=d("");previewMessages=d([]);projectOptions=d([]);selectedFocusProjectIds=d([]);projectOptionsError=d(null);openRouterUsageModalOpen=d(!1);helpModalOpen=d(!1);systemPromptModalOpen=d(!1);stackInput=d("");editingStackIndex=d(null);editingStackValue=d("");profileStacks=d([]);providerOpen=d(!1);activeTab=d("config");providerOptions=[{value:"OPENROUTER",label:"OpenRouter"},{value:"OPENAI",label:"OpenAI"},{value:"ANTHROPIC",label:"Anthropic"}];form=this.fb.nonNullable.group({activeProvider:this.fb.nonNullable.control("OPENROUTER",{validators:[h.required]}),enabled:this.fb.nonNullable.control(!0),openRouterModel:this.fb.nonNullable.control("openai/gpt-4o-mini",[h.required,h.maxLength(120)]),openAiModel:this.fb.nonNullable.control("gpt-4o-mini",[h.required,h.maxLength(120)]),anthropicModel:this.fb.nonNullable.control("claude-3-5-sonnet-latest",[h.required,h.maxLength(120)]),temperature:this.fb.nonNullable.control(.3,[h.required,h.min(0),h.max(2)]),maxTokens:this.fb.nonNullable.control(500,[h.required,h.min(64),h.max(4096)]),allowedTopicsCsv:this.fb.nonNullable.control("",[h.required,h.maxLength(1e3)]),outOfScopeMessage:this.fb.nonNullable.control("",[h.required,h.maxLength(1e3)]),systemPrompt:this.fb.nonNullable.control("",[h.required,h.maxLength(1e4)]),currentFocusProjectIdsCsv:this.fb.nonNullable.control("",[h.maxLength(1e3)]),profileStacksCsv:this.fb.nonNullable.control("",[h.maxLength(1500)])});ngOnInit(){this.loadConfig(),this.loadProjectOptions()}setTab(t){this.activeTab.set(t)}getSelectedProviderLabel(){let t=this.form.controls.activeProvider.value;return this.providerOptions.find(e=>e.value===t)?.label??t}onDocumentClick(t){let e=t.target,s=this.elementRef.nativeElement.querySelector(".provider-select");s&&!s.contains(e)&&this.providerOpen.set(!1)}loadConfig(){this.loading.set(!0),this.loadError.set(null),this.chatbotConfigService.getConfig().subscribe({next:t=>{this.form.patchValue(t),this.syncSelectedProjectsFromCsv(t.currentFocusProjectIdsCsv),this.syncProfileStacksFromCsv(t.profileStacksCsv),this.form.markAsPristine(),this.loading.set(!1)},error:()=>{this.loadError.set("No se pudo cargar la configuracion del chatbot."),this.loading.set(!1)}})}save(){if(this.form.invalid){this.form.markAllAsTouched();return}this.saving.set(!0),this.saveError.set(null),this.saveSuccess.set(null),this.form.controls.currentFocusProjectIdsCsv.setValue(this.selectedFocusProjectIds().join(",")),this.form.controls.profileStacksCsv.setValue(this.profileStacks().join(","));let t=this.form.getRawValue();this.chatbotConfigService.updateConfig(t).subscribe({next:e=>{this.form.patchValue(e),this.syncSelectedProjectsFromCsv(e.currentFocusProjectIdsCsv),this.syncProfileStacksFromCsv(e.profileStacksCsv),this.form.markAsPristine(),this.saving.set(!1),this.saveSuccess.set("Configuracion guardada correctamente.")},error:()=>{this.saving.set(!1),this.saveError.set("No se pudo guardar la configuracion. Revisa datos y conexion.")}})}loadProjectOptions(){this.projectOptionsError.set(null),this.chatbotConfigService.getPublicProjectOptions().subscribe({next:t=>this.projectOptions.set(t??[]),error:()=>this.projectOptionsError.set("No se pudo cargar la lista de proyectos publicos.")})}isProjectSelected(t){return this.selectedFocusProjectIds().includes(t)}toggleFocusProject(t,e){let a=this.selectedFocusProjectIds();e?a.includes(t)||this.selectedFocusProjectIds.set([...a,t]):this.selectedFocusProjectIds.set(a.filter(s=>s!==t)),this.form.markAsDirty()}setTestInput(t){this.testInput.set(t)}runPreviewChat(){let t=this.testInput().trim();!t||this.testing()||(this.testing.set(!0),this.testError.set(null),this.previewMessages.update(e=>[...e,{role:"user",content:t}]),this.testInput.set(""),this.chatService.sendMessage({message:t}).subscribe({next:e=>{this.previewMessages.update(a=>[...a,{role:"assistant",content:e.answer}]),this.testing.set(!1)},error:()=>{this.testing.set(!1),this.testError.set("No se pudo probar el chat. Revisa la configuracion y API key del proveedor.")}}))}openOpenRouterUsageModal(){this.openRouterUsageModalOpen.set(!0)}closeOpenRouterUsageModal(){this.openRouterUsageModalOpen.set(!1)}openHelpModal(){this.helpModalOpen.set(!0)}closeHelpModal(){this.helpModalOpen.set(!1)}openSystemPromptModal(){this.systemPromptModalOpen.set(!0)}closeSystemPromptModal(){this.systemPromptModalOpen.set(!1)}toggleProviderOpen(){this.providerOpen.set(!this.providerOpen())}selectProvider(t){this.form.controls.activeProvider.setValue(t),this.providerOpen.set(!1),this.form.markAsDirty()}setStackInput(t){this.stackInput.set(t)}addProfileStack(t){t?.preventDefault();let e=this.stackInput().trim();!e||this.profileStacks().some(s=>s.toLowerCase()===e.toLowerCase())||(this.profileStacks.update(s=>[...s,e]),this.stackInput.set(""),this.form.markAsDirty())}removeProfileStack(t){this.profileStacks.update(e=>e.filter(a=>a!==t)),this.form.markAsDirty()}startEditStack(t){let e=this.profileStacks()[t];e&&(this.editingStackIndex.set(t),this.editingStackValue.set(e))}cancelEditStack(){this.editingStackIndex.set(null),this.editingStackValue.set("")}setEditingStackValue(t){this.editingStackValue.set(t)}saveEditStack(t){let e=this.editingStackValue().trim();!e||this.profileStacks().some((s,g)=>g!==t&&s.toLowerCase()===e.toLowerCase())||(this.profileStacks.update(s=>s.map((g,B)=>B===t?e:g)),this.cancelEditStack(),this.form.markAsDirty())}syncSelectedProjectsFromCsv(t){if(!t||!t.trim()){this.selectedFocusProjectIds.set([]);return}let e=t.split(",").map(a=>Number(a.trim())).filter(a=>Number.isInteger(a)&&a>0);this.selectedFocusProjectIds.set(e)}syncProfileStacksFromCsv(t){if(!t||!t.trim()){this.profileStacks.set([]);return}let e=t.split(",").map(a=>a.trim()).filter(a=>a.length>0);this.profileStacks.set(e),this.cancelEditStack(),this.stackInput.set("")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-dashboard-chatbot-config"]],hostBindings:function(e,a){e&1&&m("click",function(g){return a.onDocumentClick(g)},!1,W)},decls:20,vars:8,consts:[[1,"chatbot-page"],[1,"chatbot-header"],[1,"dashboard-title-prefix"],[1,"dashboard-title-accent"],[1,"chatbot-tabs"],["type","button",1,"chatbot-tab-btn",3,"click"],[1,"chatbot-modal-backdrop"],[1,"chatbot-card"],[1,"chatbot-grid"],[1,"chatbot-muted"],[1,"chatbot-error"],["type","button",1,"chatbot-btn-outline",3,"click"],[1,"chatbot-form",3,"ngSubmit","formGroup"],[1,"chatbot-field"],["formControlName","activeProvider",1,"custom-select-hidden"],[3,"value"],[1,"custom-select","provider-select",3,"click"],["type","button","aria-haspopup","listbox",1,"custom-select-trigger",3,"click"],[1,"fas","fa-chevron-down","custom-select-chevron"],["role","listbox",1,"custom-select-dropdown"],["role","option",3,"selected"],[1,"chatbot-switch-row"],["type","checkbox","formControlName","enabled"],[1,"chatbot-two-col"],["formControlName","openRouterModel",1,"chatbot-input"],["formControlName","openAiModel",1,"chatbot-input"],["formControlName","anthropicModel",1,"chatbot-input"],["type","number","step","0.1","min","0","max","2","formControlName","temperature",1,"chatbot-input"],["type","number","min","64","max","4096","formControlName","maxTokens",1,"chatbot-input"],[1,"focus-projects-list"],["rows","2","formControlName","allowedTopicsCsv",1,"chatbot-input"],["rows","2","formControlName","outOfScopeMessage",1,"chatbot-input"],[1,"chatbot-field-label-row"],["type","button",1,"chatbot-btn-link",3,"click"],["rows","8","formControlName","systemPrompt",1,"chatbot-input"],[1,"chatbot-success"],[1,"chatbot-actions"],["type","submit",1,"chatbot-btn-primary",3,"disabled"],[1,"chatbot-card","chatbot-help"],[1,"chatbot-note"],["type","button",1,"chatbot-btn-outline","chatbot-usage-btn",3,"click"],[1,"chatbot-stack-editor"],[1,"chatbot-chip-input-row"],["type","text","placeholder","Agregar stack...",1,"chatbot-input",3,"input","keydown.enter","value"],["type","button","title","Agregar stack",1,"chatbot-chip-add-btn",3,"click"],[1,"chatbot-chip-list"],[1,"chatbot-muted","chatbot-stack-empty"],[1,"chatbot-card","chatbot-preview"],[1,"chatbot-preview-box"],[1,"chatbot-preview-input-row"],["placeholder","Ej: Que tecnologias usa Juan en sus proyectos?",1,"chatbot-input",3,"input","value","disabled"],["type","button",1,"chatbot-btn-primary",3,"click","disabled"],["role","option",3,"click"],[1,"focus-project-item"],["type","checkbox",3,"change","checked"],[1,"focus-project-title"],[1,"focus-project-category"],[1,"chatbot-chip"],[1,"chatbot-chip-edit-input",3,"input","keydown.enter","value"],["type","button","title","Guardar",1,"chatbot-chip-action",3,"click"],[1,"fas","fa-check"],["type","button","title","Cancelar",1,"chatbot-chip-action",3,"click"],[1,"fas","fa-times"],["type","button","title","Editar",1,"chatbot-chip-action",3,"click"],[1,"fas","fa-pen"],["type","button","title","Quitar",1,"chatbot-chip-action",3,"click"],[1,"fas","fa-trash"],[1,"chat-msg",3,"chat-msg-user","chat-msg-assistant"],[1,"chat-msg"],[1,"chatbot-modal-backdrop",3,"click"],[1,"chatbot-modal",3,"click"],[1,"chatbot-modal-header"],["type","button","aria-label","Cerrar modal",1,"chatbot-modal-close",3,"click"],["aria-hidden","true",1,"fas","fa-times"],[1,"chatbot-modal-body"],[1,"chatbot-modal-body","chatbot-help-modal-content"],["rows","20","readonly","",1,"chatbot-input","chatbot-readonly-prompt",3,"value"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"header",1)(2,"h1")(3,"span",2),r(4,"/"),n(),r(5,"Configuracion de "),i(6,"span",3),r(7,"Chatbot"),n()(),i(8,"p"),r(9,"Panel admin para elegir proveedor, modelo y reglas del asistente."),n()(),i(10,"div",4)(11,"button",5),m("click",function(){return a.setTab("config")}),r(12," Configuracion "),n(),i(13,"button",5),m("click",function(){return a.setTab("audit")}),r(14," Auditoria "),n()(),v(15,Fe,1,0,"app-chatbot-audit")(16,at,3,1),n(),v(17,st,9,0,"div",6)(18,lt,32,0,"div",6)(19,ct,9,1,"div",6)),e&2&&(l(11),O("active",a.activeTab()==="config"),l(2),O("active",a.activeTab()==="audit"),l(2),C(a.activeTab()==="audit"?15:16),l(2),C(a.openRouterUsageModalOpen()?17:-1),l(),C(a.helpModalOpen()?18:-1),l(),C(a.systemPromptModalOpen()?19:-1))},dependencies:[D,ge,oe,ce,de,te,re,ee,le,ne,ie,pe,me,ae,se,F,$],styles:['.chatbot-page[_ngcontent-%COMP%]{padding:var(--spacing-xl);color:var(--color-text-primary)}.chatbot-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.8rem}.chatbot-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.4rem 0 0;color:var(--color-text-secondary)}.chatbot-tabs[_ngcontent-%COMP%]{margin-top:1rem;display:inline-flex;gap:.45rem;padding:.22rem;border-radius:.6rem;border:1px solid color-mix(in srgb,var(--color-primary) 24%,transparent);background:color-mix(in srgb,var(--color-primary) 8%,transparent)}.chatbot-tab-btn[_ngcontent-%COMP%]{border:1px solid transparent;background:transparent;color:var(--color-text-secondary);border-radius:.45rem;padding:.45rem .72rem;font-size:.82rem;font-weight:700;cursor:pointer}.chatbot-tab-btn.active[_ngcontent-%COMP%]{color:var(--color-primary);border-color:color-mix(in srgb,var(--color-primary) 50%,transparent);background:color-mix(in srgb,var(--color-primary) 12%,transparent)}.chatbot-grid[_ngcontent-%COMP%]{margin-top:1.2rem;display:grid;grid-template-columns:2fr 1fr;gap:1.2rem}.chatbot-card[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-primary) 6%,var(--background-dark));border:1px solid color-mix(in srgb,var(--color-primary) 15%,transparent);border-radius:.75rem;padding:1.2rem}.chatbot-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.05rem}.chatbot-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.9rem}.chatbot-two-col[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.8rem}.chatbot-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.chatbot-field-label-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem}.chatbot-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.78rem;text-transform:uppercase;letter-spacing:.08em;color:var(--color-text-secondary)}.chatbot-input[_ngcontent-%COMP%]{width:100%;padding:.75rem .85rem;border-radius:.5rem;border:1px solid color-mix(in srgb,var(--color-text-primary) 22%,transparent);background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);color:var(--color-text-primary)}.chatbot-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary)}.custom-select-hidden[_ngcontent-%COMP%]{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;opacity:0;pointer-events:none}.custom-select[_ngcontent-%COMP%]{position:relative;width:100%}.custom-select-trigger[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;padding:.75rem .85rem;background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);border:1px solid color-mix(in srgb,var(--color-text-primary) 22%,transparent);border-radius:.5rem;color:var(--color-text-primary);font-size:1rem;font-family:inherit;cursor:pointer;transition:border-color .2s,box-shadow .2s;text-align:left}.custom-select.open[_ngcontent-%COMP%]   .custom-select-trigger[_ngcontent-%COMP%]{border-color:var(--color-primary);box-shadow:0 0 0 2px color-mix(in srgb,var(--color-primary) 25%,transparent)}.custom-select-trigger[_ngcontent-%COMP%]:hover{border-color:var(--color-primary)}.custom-select-chevron[_ngcontent-%COMP%]{font-size:.75rem;transition:transform .2s;color:var(--color-text-secondary)}.custom-select.open[_ngcontent-%COMP%]   .custom-select-chevron[_ngcontent-%COMP%]{transform:rotate(180deg)}.custom-select-dropdown[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 4px);left:0;right:0;margin:0;padding:.25rem 0;list-style:none;background:color-mix(in srgb,var(--color-primary) 8%,var(--background-dark));border:1px solid color-mix(in srgb,var(--color-primary) 12%,transparent);border-radius:.5rem;box-shadow:0 8px 24px #00000080;max-height:160px;overflow-y:auto;z-index:9999;display:none}.custom-select.open[_ngcontent-%COMP%]   .custom-select-dropdown[_ngcontent-%COMP%]{display:block}.custom-select-dropdown[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.625rem .75rem;color:var(--color-text-primary);cursor:pointer;transition:background .15s}.custom-select-dropdown[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover, .custom-select-dropdown[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{background:var(--color-primary-light);color:var(--color-primary)}[data-theme="light"][_nghost-%COMP%]   .custom-select-dropdown[_ngcontent-%COMP%], [data-theme="light"]   [_nghost-%COMP%]   .custom-select-dropdown[_ngcontent-%COMP%]{background:#fff;box-shadow:0 8px 24px #00000026}.chatbot-btn-link[_ngcontent-%COMP%]{border:none;background:transparent;color:var(--color-primary);font-size:.78rem;font-weight:700;letter-spacing:.03em;cursor:pointer;padding:.15rem .2rem}.chatbot-btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.chatbot-switch-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.5rem 0}.focus-projects-list[_ngcontent-%COMP%]{border:1px solid color-mix(in srgb,var(--color-text-primary) 18%,transparent);border-radius:.5rem;max-height:210px;overflow-y:auto;padding:.4rem;background:color-mix(in srgb,var(--color-text-primary) 5%,transparent)}.focus-project-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto;gap:.5rem;align-items:center;padding:.45rem .5rem;border-radius:.35rem}.focus-project-item[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--color-primary) 14%,transparent)}.focus-project-title[_ngcontent-%COMP%]{font-size:.92rem}.focus-project-category[_ngcontent-%COMP%]{font-size:.76rem;color:var(--color-text-secondary)}.chatbot-actions[_ngcontent-%COMP%]{margin-top:.4rem}.chatbot-btn-primary[_ngcontent-%COMP%], .chatbot-btn-outline[_ngcontent-%COMP%]{padding:.7rem 1rem;border-radius:.5rem;font-weight:700;cursor:pointer}.chatbot-btn-primary[_ngcontent-%COMP%]{border:none;background:var(--color-primary);color:var(--color-primary-contrast, #0b1211)}.chatbot-btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.chatbot-btn-outline[_ngcontent-%COMP%]{border:1px solid var(--color-primary);background:transparent;color:var(--color-primary)}.chatbot-usage-btn[_ngcontent-%COMP%]{margin-top:.85rem;width:100%}.chatbot-help[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:.5rem 0 .75rem;padding-left:1rem;color:var(--color-text-secondary)}.chatbot-stack-editor[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:1px solid color-mix(in srgb,var(--color-primary) 16%,transparent)}.chatbot-stack-editor[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .4rem;font-size:.92rem}.chatbot-chip-input-row[_ngcontent-%COMP%]{margin-top:.6rem;display:flex;gap:.5rem}.chatbot-chip-input-row[_ngcontent-%COMP%]   .chatbot-input[_ngcontent-%COMP%]{flex:1}.chatbot-chip-add-btn[_ngcontent-%COMP%]{flex-shrink:0;width:2.4rem;height:2.4rem;border:none;border-radius:.5rem;background:var(--color-primary);color:var(--color-primary-contrast, #0b1211);font-size:1.15rem;font-weight:700;cursor:pointer}.chatbot-chip-list[_ngcontent-%COMP%]{margin-top:.7rem;display:flex;flex-wrap:wrap;gap:.45rem}.chatbot-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.3rem .45rem;border-radius:.45rem;border:1px solid color-mix(in srgb,var(--color-text-primary) 24%,transparent);background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);font-size:.82rem}.chatbot-chip-action[_ngcontent-%COMP%]{width:1.3rem;height:1.3rem;border:none;border-radius:50%;background:transparent;color:var(--color-text-secondary);cursor:pointer;display:inline-flex;align-items:center;justify-content:center}.chatbot-chip-action[_ngcontent-%COMP%]:hover{color:var(--color-primary);background:color-mix(in srgb,var(--color-primary) 18%,transparent)}.chatbot-chip-edit-input[_ngcontent-%COMP%]{width:120px;padding:.2rem .35rem;border-radius:.35rem;border:1px solid color-mix(in srgb,var(--color-text-primary) 24%,transparent);background:color-mix(in srgb,var(--color-text-primary) 7%,transparent);color:var(--color-text-primary);font-size:.8rem}.chatbot-stack-empty[_ngcontent-%COMP%]{margin-top:.5rem}.chatbot-note[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:var(--color-text-secondary)}.chatbot-preview[_ngcontent-%COMP%]{grid-column:1 / -1}.chatbot-preview-box[_ngcontent-%COMP%]{margin-top:.75rem;border:1px solid color-mix(in srgb,var(--color-text-primary) 18%,transparent);border-radius:.5rem;min-height:170px;max-height:290px;overflow-y:auto;padding:.8rem;background:color-mix(in srgb,var(--color-text-primary) 5%,transparent)}.chat-msg[_ngcontent-%COMP%]{margin-bottom:.6rem}.chat-msg[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;line-height:1.35}.chat-msg-user[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#c7f9e7}.chat-msg-assistant[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color-text-primary)}.chatbot-preview-input-row[_ngcontent-%COMP%]{margin-top:.75rem;display:grid;grid-template-columns:1fr auto;gap:.65rem}.chatbot-error[_ngcontent-%COMP%]{color:#f87171}.chatbot-success[_ngcontent-%COMP%]{color:#4ade80}.chatbot-muted[_ngcontent-%COMP%]{color:var(--color-text-secondary)}.chatbot-modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--overlay-bg, rgba(0, 0, 0, .6));display:flex;align-items:center;justify-content:center;padding:1rem;z-index:1000;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.chatbot-modal[_ngcontent-%COMP%]{width:min(920px,100%);max-height:88vh;overflow:auto;border-radius:var(--border-radius-lg, 12px);border:1px solid var(--color-border);background:var(--modal-bg, var(--color-surface))}.chatbot-modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.8rem;padding:1rem 1.25rem;border-bottom:1px solid var(--color-border)}.chatbot-modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.chatbot-modal-close[_ngcontent-%COMP%]{width:2rem;height:2rem;border-radius:var(--border-radius-md);border:none;background:transparent;color:var(--color-text-secondary);cursor:pointer}.chatbot-modal-close[_ngcontent-%COMP%]:hover{background:var(--color-primary-light);color:var(--color-primary)}.chatbot-modal-body[_ngcontent-%COMP%]{padding:1rem 1.25rem 1.25rem}.chatbot-help-modal-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:.2rem 0 .9rem;padding-left:1.1rem;color:var(--color-text-secondary)}.chatbot-readonly-prompt[_ngcontent-%COMP%]{min-height:360px;resize:vertical;white-space:pre-wrap;line-height:1.45}@media (max-width: 1024px){.chatbot-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 700px){.chatbot-two-col[_ngcontent-%COMP%], .chatbot-preview-input-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}']})};export{fe as DashboardChatbotConfigComponent};
