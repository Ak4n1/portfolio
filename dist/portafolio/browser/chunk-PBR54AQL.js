import{a as E}from"./chunk-RN22FLO7.js";import{a as k}from"./chunk-33UCSS4H.js";import{c as I,d as p,e as L,f as N,k as T,m as z,n as D,u as A,w as G}from"./chunk-SBYHMJI5.js";import{f as S,g as F}from"./chunk-3STYZOIF.js";import"./chunk-DW4U6NCB.js";import"./chunk-WY3MPDUA.js";import{k as h,s as v}from"./chunk-RKUWSNO2.js";import{Ab as l,Ib as c,Jb as x,Rb as i,Sb as O,Ua as s,Za as P,_ as g,cb as f,hb as d,ob as y,pb as m,ra as _,rb as C,sb as M,t as w,yb as t,zb as r}from"./chunk-VJKI3SXJ.js";function Y(a,o){a&1&&(t(0,"span",16),i(1,"Email v\xE1lido requerido"),r())}function H(a,o){a&1&&(t(0,"span",16),i(1,"M\xEDnimo 6 caracteres"),r())}var b=class a{constructor(o){this.fb=o;this.form=this.fb.group({email:["",[p.required,p.email]],password:["",[p.required,p.minLength(6)]]})}submitForm=_();close=_();form;isFieldInvalid(o){let e=this.form.get(o);return!!e&&e.invalid&&(e.dirty||e.touched)}showPassword=!1;togglePassword(){this.showPassword=!this.showPassword}onSubmit(){this.form.valid?this.submitForm.emit(this.form.value):Object.keys(this.form.controls).forEach(o=>this.form.get(o)?.markAsTouched())}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||a)(P(A))};static \u0275cmp=f({type:a,selectors:[["app-login-form"]],outputs:{submitForm:"submitForm",close:"close"},decls:24,vars:12,consts:[[1,"auth-form"],[1,"auth-title"],[1,"auth-subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","login-email"],["id","login-email","type","email","formControlName","email","placeholder","tu@email.com"],["class","error-msg",4,"ngIf"],["for","login-password"],[1,"password-input-wrapper"],["id","login-password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"password-input-field",3,"type"],["type","button",1,"password-toggle",3,"click"],["aria-hidden","true"],[1,"auth-actions"],["type","button",1,"btn-cancel",3,"click"],["type","submit",1,"btn-submit",3,"disabled"],[1,"error-msg"]],template:function(e,n){e&1&&(t(0,"div",0)(1,"h2",1),i(2,"Ingresar"),r(),t(3,"p",2),i(4,"Ingresa tus credenciales para acceder"),r(),t(5,"form",3),c("ngSubmit",function(){return n.onSubmit()}),t(6,"div",4)(7,"label",5),i(8,"Email"),r(),l(9,"input",6),d(10,Y,2,0,"span",7),r(),t(11,"div",4)(12,"label",8),i(13,"Contrase\xF1a"),r(),t(14,"div",9),l(15,"input",10),t(16,"button",11),c("click",function(){return n.togglePassword()}),l(17,"i",12),r()(),d(18,H,2,0,"span",7),r(),t(19,"div",13)(20,"button",14),c("click",function(){return n.onClose()}),i(21,"Cancelar"),r(),t(22,"button",15),i(23,"Entrar"),r()()()()),e&2&&(s(5),m("formGroup",n.form),s(4),C("error",n.isFieldInvalid("email")),s(),m("ngIf",n.isFieldInvalid("email")),s(5),C("error",n.isFieldInvalid("password")),m("type",n.showPassword?"text":"password"),s(),y("aria-label",n.showPassword?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),s(),M(n.showPassword?"fas fa-eye":"fas fa-eye-slash"),s(),m("ngIf",n.isFieldInvalid("password")),s(4),m("disabled",n.form.invalid))},dependencies:[G,T,I,L,N,z,D,v,h],styles:[".auth-form[_ngcontent-%COMP%]{padding:.5rem}.auth-title[_ngcontent-%COMP%]{color:var(--title-primary);font-size:1.5rem;margin-bottom:.5rem;text-align:center}.auth-subtitle[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.9rem;text-align:center;margin-bottom:1.25rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--text-primary);font-size:.9rem;font-weight:500;margin-bottom:.35rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.65rem .75rem;background:var(--background-card);border:1px solid var(--border-color);border-radius:8px;color:var(--text-primary);font-size:.95rem;transition:border-color .2s,box-shadow .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--text-secondary);opacity:.8}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 2px #00b89433}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:var(--error)}.password-input-wrapper[_ngcontent-%COMP%]{position:relative;width:100%}.password-input-field[_ngcontent-%COMP%]{padding-right:3rem;width:100%}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);background:transparent;border:none;cursor:pointer;padding:.5rem;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);transition:color .2s ease;min-width:32px;min-height:32px;z-index:1}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--text-primary)}.password-toggle[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--primary-color);outline-offset:2px}.password-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem;color:currentColor}.error-msg[_ngcontent-%COMP%]{color:var(--error);font-size:.8rem;margin-top:.25rem;display:block}.auth-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:1.25rem}.btn-cancel[_ngcontent-%COMP%], .btn-submit[_ngcontent-%COMP%]{flex:1;padding:.6rem 1rem;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s}.btn-cancel[_ngcontent-%COMP%]{background:transparent;color:var(--text-secondary);border:1px solid var(--border-color)}.btn-cancel[_ngcontent-%COMP%]:hover{background:var(--background-card);color:var(--text-primary);border-color:var(--border-hover)}.btn-submit[_ngcontent-%COMP%]{background:var(--primary-color);color:var(--background-dark);border:none;box-shadow:var(--shadow-neon)}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){filter:brightness(1.1);box-shadow:var(--shadow-neon)}.btn-submit[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};function J(a,o){if(a&1&&(t(0,"p",7),i(1),r()),a&2){let e=x();s(),O(e.serverError)}}var j=class a{router=g(S);authService=g(E);authStateService=g(k);serverError="";ngOnInit(){if(this.authStateService.value.isAuthenticated){this.router.navigate(["/dashboard"]);return}w(this.authService.refreshToken()).then(o=>{o?.user&&(this.authStateService.setAuthenticated(o.user),this.router.navigate(["/dashboard"]))}).catch(()=>{})}onClose(){this.router.navigate(["/home"])}onSubmit(o){this.serverError="",this.authService.login(o.email,o.password).subscribe({next:e=>{this.authStateService.setAuthenticated(e.user),this.router.navigate(["/dashboard"])},error:e=>{if(e.status===403&&e.error?.message?.includes("verificado")){this.router.navigate(["/verify-email-pending"],{queryParams:{email:o.email,fromLogin:"true"}});return}this.serverError=e.error?.message||"Email o contrase\xF1a inv\xE1lidos"}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=f({type:a,selectors:[["app-login"]],decls:11,vars:1,consts:[[1,"auth-page"],[1,"auth-container"],["class","auth-error",4,"ngIf"],[3,"submitForm","close"],[1,"auth-footer"],["routerLink","/register"],["routerLink","/forgot-password"],[1,"auth-error"]],template:function(e,n){e&1&&(t(0,"section",0)(1,"div",1),d(2,J,2,1,"p",2),t(3,"app-login-form",3),c("submitForm",function(B){return n.onSubmit(B)})("close",function(){return n.onClose()}),r(),t(4,"p",4),i(5," \xBFNo tienes cuenta? "),t(6,"a",5),i(7,"Registrarse"),r(),l(8,"br"),t(9,"a",6),i(10,"\xBFOlvidaste tu contrase\xF1a?"),r()()()()),e&2&&(s(2),m("ngIf",n.serverError))},dependencies:[v,h,b,F],styles:[".auth-page[_ngcontent-%COMP%]{min-height:80vh;display:flex;align-items:center;justify-content:center;padding:2rem}.auth-container[_ngcontent-%COMP%]{width:100%;max-width:420px;background:var(--background-card);border:1px solid var(--border-color);border-radius:12px;padding:2rem}.auth-error[_ngcontent-%COMP%]{color:var(--error, #e74c3c);font-size:.9rem;margin-bottom:1rem;text-align:center}.auth-footer[_ngcontent-%COMP%]{text-align:center;margin-top:1.25rem;font-size:.95rem;color:var(--text-secondary)}.auth-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary-color);text-decoration:none;font-weight:600}.auth-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})};export{j as LoginComponent};
