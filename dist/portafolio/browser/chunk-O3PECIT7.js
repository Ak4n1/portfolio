import{a as E}from"./chunk-RN22FLO7.js";import{c as k,d as p,e as F,f as I,k as R,m as N,n as T,u as G,w as L}from"./chunk-SBYHMJI5.js";import{d as S,f as y,g as O}from"./chunk-3STYZOIF.js";import"./chunk-DW4U6NCB.js";import"./chunk-WY3MPDUA.js";import{k as x,s as M}from"./chunk-RKUWSNO2.js";import{Ab as f,Eb as C,Ib as _,Jb as u,Rb as o,Sb as w,Tb as P,Ua as a,_ as c,cb as v,fa as b,ga as h,hb as d,pb as m,rb as g,tb as l,yb as r,zb as n}from"./chunk-VJKI3SXJ.js";function D(i,t){i&1&&(r(0,"span",14),o(1,"M\xEDnimo 6 caracteres"),n())}function A(i,t){i&1&&(r(0,"span",14),o(1,"Las contrase\xF1as no coinciden"),n())}function j(i,t){if(i&1){let e=C();r(0,"h2",2),o(1,"Nueva Contrase\xF1a"),n(),r(2,"p",3),o(3,"Ingresa tu nueva contrase\xF1a."),n(),r(4,"form",4),_("ngSubmit",function(){b(e);let z=u();return h(z.onSubmit())}),r(5,"div",5)(6,"label",6),o(7,"Nueva contrase\xF1a"),n(),f(8,"input",7),d(9,D,2,0,"span",8),n(),r(10,"div",5)(11,"label",9),o(12,"Confirmar contrase\xF1a"),n(),f(13,"input",10),d(14,A,2,0,"span",8),n(),r(15,"div",11)(16,"a",12),o(17,"Cancelar"),n(),r(18,"button",13),o(19),n()()()}if(i&2){let e=u();a(4),m("formGroup",e.form),a(4),g("error",e.isFieldInvalid("newPassword")),a(),m("ngIf",e.isFieldInvalid("newPassword")),a(4),g("error",e.isConfirmInvalid()),a(),m("ngIf",e.isConfirmInvalid()),a(4),m("disabled",e.form.invalid||e.isSubmitting),a(),P(" ",e.isSubmitting?"Guardando...":"Restablecer"," ")}}function q(i,t){i&1&&(r(0,"h2",2),o(1,"\xA1Contrase\xF1a actualizada!"),n(),r(2,"p",15),o(3,"Ya puedes iniciar sesi\xF3n con tu nueva contrase\xF1a."),n(),r(4,"a",16),o(5,"Iniciar Sesi\xF3n"),n())}function B(i,t){if(i&1&&(r(0,"h2",2),o(1,"Error"),n(),r(2,"p",17),o(3),n(),r(4,"div",11)(5,"a",18),o(6,"Solicitar nuevo enlace"),n(),r(7,"a",16),o(8,"Ir a Login"),n()()),i&2){let e=u();a(3),w(e.errorMessage)}}var V=class i{fb=c(G);route=c(S);router=c(y);authService=c(E);form;isSubmitting=!1;state="form";errorMessage="";token="";constructor(){this.form=this.fb.group({newPassword:["",[p.required,p.minLength(6)]],confirmPassword:["",[p.required]]},{validators:this.passwordMatchValidator})}passwordMatchValidator(t){let e=t.get("newPassword")?.value,s=t.get("confirmPassword")?.value;return e===s?null:{mismatch:!0}}ngOnInit(){this.route.params.subscribe(t=>{this.token=t.token||"",this.token||(this.state="error",this.errorMessage="Token no encontrado. Usa el enlace del email.")})}isFieldInvalid(t){let e=this.form.get(t);return!!e&&e.invalid&&(e.dirty||e.touched)}isConfirmInvalid(){let t=this.form.get("confirmPassword");return!!t&&this.form.hasError("mismatch")&&(t.dirty||t.touched)}onSubmit(){if(this.form.invalid||this.isSubmitting||!this.token)return;this.isSubmitting=!0,this.errorMessage="";let t=this.form.get("newPassword")?.value;this.authService.resetPassword(this.token,t).subscribe({next:()=>{this.isSubmitting=!1,this.state="success"},error:e=>{this.isSubmitting=!1,this.state="error",this.errorMessage=e.error?.message||"El enlace ha expirado o ya fue utilizado."}})}goToLogin(){this.router.navigate(["/login"])}goToForgotPassword(){this.router.navigate(["/forgot-password"])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["app-reset-password"]],decls:5,vars:3,consts:[[1,"auth-page"],[1,"auth-container"],[1,"auth-title"],[1,"auth-message"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","newPassword"],["id","newPassword","type","password","formControlName","newPassword","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"],["class","error-msg",4,"ngIf"],["for","confirmPassword"],["id","confirmPassword","type","password","formControlName","confirmPassword","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"],[1,"auth-actions"],["routerLink","/login",1,"btn-cancel"],["type","submit",1,"btn-submit",3,"disabled"],[1,"error-msg"],[1,"auth-success"],["routerLink","/login",1,"btn-submit"],[1,"auth-error"],["routerLink","/forgot-password",1,"btn-secondary"]],template:function(e,s){e&1&&(r(0,"section",0)(1,"div",1),d(2,j,20,9)(3,q,6,0)(4,B,9,1),n()()),e&2&&(a(2),l(s.state==="form"?2:-1),a(),l(s.state==="success"?3:-1),a(),l(s.state==="error"?4:-1))},dependencies:[M,x,L,R,k,F,I,N,T,O],styles:[".auth-page[_ngcontent-%COMP%]{min-height:80vh;display:flex;align-items:center;justify-content:center;padding:2rem}.auth-container[_ngcontent-%COMP%]{width:100%;max-width:420px;background:var(--background-card);border:1px solid var(--border-color);border-radius:12px;padding:2rem}.auth-title[_ngcontent-%COMP%]{color:var(--title-primary);font-size:1.5rem;margin-bottom:1rem;text-align:center}.auth-message[_ngcontent-%COMP%], .auth-success[_ngcontent-%COMP%], .auth-error[_ngcontent-%COMP%]{margin-bottom:1rem}.auth-success[_ngcontent-%COMP%]{color:var(--primary-color)}.auth-error[_ngcontent-%COMP%]{color:var(--error, #e74c3c)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--text-primary);font-size:.9rem;font-weight:500;margin-bottom:.35rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.65rem .75rem;background:var(--background-card);border:1px solid var(--border-color);border-radius:8px;color:var(--text-primary);font-size:.95rem}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:var(--error, #e74c3c)}.error-msg[_ngcontent-%COMP%]{color:var(--error, #e74c3c);font-size:.8rem;margin-top:.25rem;display:block}.auth-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:1.25rem}.btn-cancel[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .btn-submit[_ngcontent-%COMP%]{flex:1;padding:.6rem 1rem;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;text-align:center;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}.btn-cancel[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{background:transparent;color:var(--text-secondary);border:1px solid var(--border-color)}.btn-submit[_ngcontent-%COMP%]{background:var(--primary-color);color:var(--background-dark);border:none}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){filter:brightness(1.1)}.btn-submit[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};export{V as ResetPasswordComponent};
