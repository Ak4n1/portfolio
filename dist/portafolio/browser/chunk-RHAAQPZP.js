import{Q as k,S as b,U as x,_ as o,a,b as u,da as f,f as d,i as j,la as v,m as w,ma as c,oc as l,t as h,ua as S}from"./chunk-VJKI3SXJ.js";function A(r){r||(f(A),r=o(c));let e=new j(t=>r.onDestroy(t.next.bind(t)));return t=>t.pipe(k(e))}function g(r,e){let t=!e?.manualCleanup;t&&!e?.injector&&f(g);let n=t?e?.injector?.get(c)??o(c):null,m=R(e?.equal),s;e?.requireSync?s=S({kind:0},{equal:m}):s=S({kind:1,value:e?.initialValue},{equal:m});let p,y=r.subscribe({next:i=>s.set({kind:1,value:i}),error:i=>{if(e?.rejectErrors)throw i;s.set({kind:2,error:i})},complete:()=>{p?.()}});if(e?.requireSync&&s().kind===0)throw new b(601,!1);return p=n?.onDestroy(y.unsubscribe.bind(y)),l(()=>{let i=s();switch(i.kind){case 1:return i.value;case 2:throw i.error;case 0:throw new b(601,!1)}},{equal:e?.equal})}function R(r=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&r(e.value,t.value)}var D=class r{injector=o(v);initialized=!1;initialState={isAuthenticated:!1,user:null,isLoading:!0};authStateSubject=new w(this.initialState);authState=this.authStateSubject.asObservable();userStateSignal=g(this.authState,{initialValue:this.initialState});currentUser=l(()=>this.userStateSignal().user);constructor(){this.initializeAuthState()}initializeAuthState(){return d(this,null,function*(){if(!this.initialized){this.initialized=!0,this.setLoading(!0);try{let{AuthService:e}=yield import("./chunk-WXXCDTTC.js"),t=this.injector.get(e),n=yield h(t.refreshToken());n?.user?this.setAuthenticated(n.user):this.clearState()}catch{this.clearState()}finally{this.setLoading(!1)}}})}setAuthenticated(e){this.authStateSubject.next({isAuthenticated:!0,user:e,isLoading:!1})}setLoggedOut(){this.clearState()}setLoading(e){this.authStateSubject.next(u(a({},this.authStateSubject.value),{isLoading:e}))}clearState(){this.authStateSubject.next(u(a({},this.initialState),{isLoading:!1}))}refreshUserState(){return d(this,null,function*(){if(this.value.isAuthenticated)try{let{AuthService:e}=yield import("./chunk-WXXCDTTC.js"),t=this.injector.get(e),n=yield h(t.refreshToken());n?.user&&this.setAuthenticated(n.user)}catch{this.clearState()}})}get value(){return this.authStateSubject.value}static \u0275fac=function(t){return new(t||r)};static \u0275prov=x({token:r,factory:r.\u0275fac,providedIn:"root"})};export{A as a,g as b,D as c};
