import{a as q}from"./chunk-SYPDHHHG.js";import{a as F}from"./chunk-RN22FLO7.js";import{a as D}from"./chunk-33UCSS4H.js";import{c as N,d as s,e as z,f as A,k as T,m as V,n as R,u as L,w as G}from"./chunk-SBYHMJI5.js";import{f as S,g as k}from"./chunk-3STYZOIF.js";import"./chunk-DW4U6NCB.js";import"./chunk-WY3MPDUA.js";import{s as E}from"./chunk-RKUWSNO2.js";import{Ab as g,Eb as w,Ib as p,Jb as u,Rb as n,Sb as x,Tb as M,Ua as l,_ as f,_b as O,cb as P,fa as _,ga as y,hb as h,oc as C,pb as m,tb as v,ua as d,yb as t,zb as e}from"./chunk-VJKI3SXJ.js";var U=()=>["/contact"];function j(a,r){if(a&1){let i=w();t(0,"form",16),p("ngSubmit",function(){_(i);let c=u();return y(c.saveProfile())}),t(1,"div",45)(2,"div",17)(3,"label",18),n(4,"Nombre"),e(),g(5,"input",46),e(),t(6,"div",17)(7,"label",18),n(8,"Apellido"),e(),g(9,"input",47),e(),t(10,"div",48)(11,"label",18),n(12,"Email (solo lectura)"),e(),t(13,"div",49),g(14,"input",50),t(15,"span",51),n(16,"lock"),e()()()(),t(17,"div",52)(18,"div",53)(19,"span",54),n(20,"calendar_today"),e(),t(21,"span",55),n(22),e()(),t(23,"button",56),n(24," Guardar Cambios "),e()()()}if(a&2){let i=u();m("formGroup",i.profileForm),l(22),M("Miembro desde: ",i.memberSinceFormatted(),""),l(),m("disabled",i.profileForm.invalid||i.profileForm.pristine||i.savingProfile())}}function B(a,r){if(a&1&&(t(0,"p",14),n(1),e()),a&2){let i=u();l(),x(i.loadError())}}function H(a,r){a&1&&(t(0,"p",15),n(1,"Cargando..."),e())}function Y(a,r){a&1&&(t(0,"p",23),n(1,"Las contrase\xF1as no coinciden."),e())}function J(a,r){if(a&1&&(t(0,"p",36),n(1),e()),a&2){let i=u();l(),x(i.receiveEmailsError())}}function K(){return a=>{let r=a,i=r.get("newPassword")?.value,o=r.get("confirmPassword")?.value;return i!==o&&o!==""?{passwordMismatch:!0}:null}}var I=class a{authService=f(F);authStateService=f(D);fb=f(L);router=f(S);profile=d(null);loadError=d(null);savingProfile=d(!1);savingPassword=d(!1);receiveEmails=d(!0);confirmDisableVisible=d(!1);receiveEmailsError=d(null);profileForm=this.fb.group({firstName:["",[s.required,s.minLength(2)]],lastName:["",[s.required,s.minLength(2)]],email:[{value:"",disabled:!0}]});passwordForm=this.fb.group({currentPassword:["",[s.required]],newPassword:["",[s.required,s.minLength(6)]],confirmPassword:["",[s.required]]},{validators:K()});memberSinceFormatted=C(()=>{let r=this.profile();return r?.createdAt?new Date(r.createdAt).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}).toUpperCase():"\u2014"});confirmDisableMessage=C(()=>"Tu cuenta se deshabilitar\xE1 y no podr\xE1s iniciar sesi\xF3n hasta que un administrador la reactive. \xBFContinuar?");ngOnInit(){this.loadProfile()}loadProfile(){this.loadError.set(null),this.authService.getProfile().subscribe({next:r=>{this.profile.set(r),this.profileForm.patchValue({firstName:r.firstName??"",lastName:r.lastName??"",email:r.email??""}),this.receiveEmails.set(r.receiveNotificationEmails??!0)},error:()=>this.loadError.set("No se pudo cargar el perfil.")})}saveProfile(){if(this.profileForm.invalid)return;let r=this.profileForm.getRawValue(),i={firstName:r.firstName?.trim(),lastName:r.lastName?.trim(),receiveNotificationEmails:this.receiveEmails()};this.savingProfile.set(!0),this.authService.updateProfile(i).subscribe({next:o=>{this.profile.set(o),this.authStateService.setAuthenticated(o),this.savingProfile.set(!1)},error:()=>this.savingProfile.set(!1)})}updatePassword(){if(this.passwordForm.invalid)return;let r=this.passwordForm.getRawValue();this.savingPassword.set(!0),this.authService.changePassword(r.currentPassword,r.newPassword).subscribe({next:()=>{this.passwordForm.reset(),this.savingPassword.set(!1)},error:()=>this.savingPassword.set(!1)})}goToForgotPassword(){this.authService.logout().subscribe({next:()=>{this.authStateService.setLoggedOut(),this.router.navigate(["/forgot-password"])}})}toggleReceiveEmails(r){let i=r.target.checked,o=this.receiveEmails();this.receiveEmails.set(i),this.receiveEmailsError.set(null),this.authService.updateProfile({receiveNotificationEmails:i}).subscribe({next:c=>{this.profile.set(c),this.authStateService.setAuthenticated(c),this.receiveEmails.set(c.receiveNotificationEmails??i)},error:()=>{this.receiveEmails.set(o),this.receiveEmailsError.set("No se pudo guardar la preferencia. Comprueba la conexi\xF3n o contacta soporte.")}})}openDisableAccountModal(){this.confirmDisableVisible.set(!0)}closeDisableAccountModal(){this.confirmDisableVisible.set(!1)}onConfirmDisableAccount(){this.authService.disableAccount().subscribe({next:()=>{this.closeDisableAccountModal(),this.authStateService.setLoggedOut(),window.location.href="/"},error:()=>this.closeDisableAccountModal()})}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=P({type:a,selectors:[["app-dashboard-configuracion"]],decls:80,vars:10,consts:[[1,"config-page"],[1,"config-header"],[1,"config-header-inner"],[1,"config-header-titles"],[1,"config-title"],[1,"config-title-accent"],[1,"config-subtitle"],[1,"config-grid"],[1,"config-main"],[1,"cyber-card","config-section"],[1,"config-section-header"],[1,"material-symbols-outlined","config-section-icon"],[1,"config-section-title"],[1,"config-form",3,"formGroup"],[1,"config-error"],[1,"config-muted"],[1,"config-form",3,"ngSubmit","formGroup"],[1,"config-field"],[1,"config-label"],["formControlName","currentPassword","type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"config-input"],[1,"config-form-row"],["formControlName","newPassword","type","password","placeholder","Escribe tu nueva contrase\xF1a",1,"config-input"],["formControlName","confirmPassword","type","password","placeholder","Repite la contrase\xF1a",1,"config-input"],[1,"config-field-error"],[1,"config-password-actions"],["type","submit",1,"config-btn-outline",3,"disabled"],["type","button",1,"config-btn-link",3,"click"],[1,"config-danger-zone"],["type","button",1,"config-btn-danger",3,"click"],[1,"config-sidebar"],[1,"config-notif"],[1,"config-notif-row"],[1,"config-notif-label"],[1,"config-switch"],["type","checkbox",3,"change","checked"],[1,"config-switch-slider"],[1,"config-field-error","config-notif-error"],[1,"config-notif-info"],[1,"config-help-card"],[1,"material-symbols-outlined","config-help-icon"],[1,"config-help-title"],[1,"config-help-text"],[1,"config-help-link",3,"routerLink"],[1,"material-symbols-outlined","config-help-arrow"],["title","Deshabilitar cuenta","type","danger","confirmText","Deshabilitar","cancelText","Cancelar",3,"confirmed","cancelled","visible","message"],[1,"config-form-grid"],["formControlName","firstName","type","text",1,"config-input"],["formControlName","lastName","type","text",1,"config-input"],[1,"config-field","config-field-full"],[1,"config-input-wrap","config-input-readonly"],["formControlName","email","type","email","readonly","",1,"config-input"],[1,"material-symbols-outlined","config-input-icon"],[1,"config-section-footer"],[1,"config-badge"],[1,"material-symbols-outlined","config-badge-icon"],[1,"config-badge-text"],["type","submit",1,"config-btn-primary",3,"disabled"]],template:function(i,o){if(i&1&&(t(0,"div",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"h1",4)(5,"span",5),n(6,"/"),e(),n(7,"Configuraci\xF3n "),e(),t(8,"p",6),n(9,"Personaliza tu entorno de desarrollo y preferencias de seguridad."),e()()()(),t(10,"div",7)(11,"div",8)(12,"section",9)(13,"div",10)(14,"span",11),n(15,"account_circle"),e(),t(16,"h2",12),n(17,"Datos de la cuenta"),e()(),h(18,j,25,3,"form",13)(19,B,2,1,"p",14)(20,H,2,0,"p",15),e(),t(21,"section",9)(22,"div",10)(23,"span",11),n(24,"shield_lock"),e(),t(25,"h2",12),n(26,"Seguridad"),e()(),t(27,"form",16),p("ngSubmit",function(){return o.updatePassword()}),t(28,"div",17)(29,"label",18),n(30,"Contrase\xF1a actual"),e(),g(31,"input",19),e(),t(32,"div",20)(33,"div",17)(34,"label",18),n(35,"Nueva contrase\xF1a"),e(),g(36,"input",21),e(),t(37,"div",17)(38,"label",18),n(39,"Confirmar nueva contrase\xF1a"),e(),g(40,"input",22),e()(),h(41,Y,2,0,"p",23),t(42,"div",24)(43,"button",25),n(44," Actualizar Contrase\xF1a "),e(),t(45,"button",26),p("click",function(){return o.goToForgotPassword()}),n(46," \xBFOlvidaste tu contrase\xF1a? "),e()()(),t(47,"div",27)(48,"button",28),p("click",function(){return o.openDisableAccountModal()}),n(49," Deshabilitar cuenta "),e()()()(),t(50,"aside",29)(51,"section",9)(52,"div",10)(53,"span",11),n(54,"mail"),e(),t(55,"h2",12),n(56,"Notificaciones"),e()(),t(57,"div",30)(58,"div",31)(59,"span",32),n(60,"Alertas por email"),e(),t(61,"label",33)(62,"input",34),p("change",function(b){return o.toggleReceiveEmails(b)}),e(),g(63,"span",35),e()(),h(64,J,2,1,"p",36),t(65,"div",37)(66,"p"),n(67,"Recibir\xE1s correos sobre anuncios, actualizaciones y recordatorios. Los correos transaccionales (seguridad, verificaci\xF3n) son obligatorios y no se pueden desactivar."),e()()()(),t(68,"section",38)(69,"span",39),n(70,"support_agent"),e(),t(71,"h3",40),n(72,"\xBFNecesitas ayuda?"),e(),t(73,"p",41),n(74,"Si tienes problemas con tu cuenta o seguridad, contacta con nuestro equipo."),e(),t(75,"a",42),n(76," Contactar "),t(77,"span",43),n(78,"arrow_forward"),e()()()()()(),t(79,"app-confirm-modal",44),p("confirmed",function(){return o.onConfirmDisableAccount()})("cancelled",function(){return o.closeDisableAccountModal()}),e()),i&2){let c,b;l(18),v((c=o.profile())?18:o.loadError()?19:20,c),l(9),m("formGroup",o.passwordForm),l(14),v((b=o.passwordForm.get("confirmPassword"))!=null&&b.touched&&o.passwordForm.hasError("passwordMismatch")?41:-1),l(2),m("disabled",o.passwordForm.invalid||o.savingPassword()),l(19),m("checked",o.receiveEmails()),l(2),v(o.receiveEmailsError()?64:-1),l(11),m("routerLink",O(9,U)),l(4),m("visible",o.confirmDisableVisible())("message",o.confirmDisableMessage())}},dependencies:[E,k,G,T,N,z,A,V,R,q],styles:['.config-page[_ngcontent-%COMP%]{padding:var(--spacing-xl);max-width:100%;margin:0 auto;color:var(--color-text-primary);background-color:var(--background-dark);min-height:100%}.config-header[_ngcontent-%COMP%]{margin-bottom:2.5rem}.config-header-inner[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:flex-end;gap:var(--spacing-lg)}.config-header-titles[_ngcontent-%COMP%]{flex:1;min-width:0}.config-title[_ngcontent-%COMP%]{font-size:clamp(1.75rem,4vw,2.25rem);font-weight:800;letter-spacing:-.02em;color:var(--color-text-primary);margin:0;display:flex;align-items:center;gap:.5rem}.config-title-accent[_ngcontent-%COMP%]{color:var(--color-primary)}.config-subtitle[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:1rem;margin:.5rem 0 0}.config-btn-profile[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.625rem 1.25rem;background:var(--color-primary-light);color:var(--color-primary);border:1px solid color-mix(in srgb,var(--color-primary) 35%,transparent);border-radius:var(--border-radius-md);font-weight:700;font-size:.875rem;text-transform:uppercase;letter-spacing:.05em;text-decoration:none;transition:background .2s,box-shadow .2s}.config-btn-profile[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--color-primary) 25%,transparent);box-shadow:0 0 15px color-mix(in srgb,var(--color-primary) 30%,transparent)}.config-btn-icon[_ngcontent-%COMP%]{font-size:1.25rem}.config-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:var(--spacing-xl)}@media (min-width: 1024px){.config-grid[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}}.config-main[_ngcontent-%COMP%], .config-sidebar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xl)}.cyber-card[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-primary) 6%,var(--background-dark));-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid color-mix(in srgb,var(--color-primary) 12%,transparent);border-radius:.75rem;padding:1.5rem}@media (min-width: 1024px){.cyber-card[_ngcontent-%COMP%]{padding:2rem}}.config-section-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:2rem}.config-section-icon[_ngcontent-%COMP%]{color:var(--color-primary);font-size:1.5rem}.config-section-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;text-transform:uppercase;letter-spacing:.03em;color:var(--color-text-primary);margin:0}.config-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.config-form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.config-field-full[_ngcontent-%COMP%]{grid-column:1 / -1}@media (max-width: 767px){.config-form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.config-form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}@media (max-width: 767px){.config-form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.config-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.config-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;color:var(--color-text-secondary);margin-left:.25rem}.config-input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem;background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);border:1px solid color-mix(in srgb,var(--color-text-primary) 25%,transparent);border-radius:var(--border-radius-md);color:var(--color-text-primary);font-size:1rem;transition:border-color .2s,box-shadow .2s}.config-input[_ngcontent-%COMP%]::placeholder{color:var(--color-text-secondary)}.config-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 2px color-mix(in srgb,var(--color-primary) 25%,transparent)}.config-input-wrap[_ngcontent-%COMP%]{position:relative}.config-input-readonly[_ngcontent-%COMP%]   .config-input[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-text-primary) 4%,transparent);color:var(--color-text-secondary);cursor:not-allowed;font-style:italic}.config-input-icon[_ngcontent-%COMP%]{position:absolute;right:1rem;top:50%;transform:translateY(-50%);color:var(--color-text-secondary);font-size:1.25rem;pointer-events:none}.config-section-footer[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid color-mix(in srgb,var(--color-text-primary) 15%,transparent);display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem}.config-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.375rem .75rem;background:var(--color-primary-light);border:1px solid color-mix(in srgb,var(--color-primary) 15%,transparent);border-radius:var(--border-radius-md)}.config-badge-icon[_ngcontent-%COMP%]{color:var(--color-primary);font-size:.875rem}.config-badge-text[_ngcontent-%COMP%]{font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--color-primary);opacity:.9}.config-btn-primary[_ngcontent-%COMP%]{padding:.75rem 2rem;background:var(--color-primary);color:var(--color-primary-contrast, #0a0f0e);border:none;border-radius:var(--border-radius-md);font-weight:800;font-size:.875rem;text-transform:uppercase;letter-spacing:.03em;cursor:pointer;transition:background .2s,box-shadow .2s}.config-btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:color-mix(in srgb,var(--color-primary) 90%,white);box-shadow:0 0 20px color-mix(in srgb,var(--color-primary) 40%,transparent)}.config-btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.config-btn-outline[_ngcontent-%COMP%]{padding:.75rem 2rem;background:transparent;color:var(--color-primary);border:2px solid var(--color-primary);border-radius:var(--border-radius-md);font-weight:800;font-size:.875rem;text-transform:uppercase;letter-spacing:.03em;cursor:pointer;transition:background .2s}.config-btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--color-primary-light)}.config-btn-outline[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.config-password-actions[_ngcontent-%COMP%]{padding-top:.5rem;display:flex;flex-wrap:wrap;align-items:center;gap:1rem}.config-btn-link[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem 0;font-size:.875rem;color:var(--color-text-secondary);cursor:pointer;text-decoration:underline;text-underline-offset:.2em;transition:color .2s}.config-btn-link[_ngcontent-%COMP%]:hover{color:var(--color-primary)}.config-field-error[_ngcontent-%COMP%]{font-size:.8125rem;color:#f87171;margin:-.5rem 0 0}.config-notif-error[_ngcontent-%COMP%]{margin:.5rem 0 0}.config-danger-zone[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid color-mix(in srgb,var(--color-text-primary) 15%,transparent)}.config-btn-danger[_ngcontent-%COMP%]{padding:.5rem 1rem;background:transparent;color:#f87171;border:1px solid color-mix(in srgb,#ef4444 40%,transparent);border-radius:var(--border-radius-md);font-size:.875rem;font-weight:600;cursor:pointer;transition:background .2s,color .2s}.config-btn-danger[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,#ef4444 15%,transparent);color:#fca5a5}.config-notif[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.config-notif-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.config-notif-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:700;text-transform:uppercase;letter-spacing:.03em;color:var(--color-text-primary)}.config-switch[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;cursor:pointer}.config-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0}.config-switch-slider[_ngcontent-%COMP%]{position:relative;display:block;width:3rem;height:1.5rem;background:color-mix(in srgb,var(--color-text-primary) 20%,transparent);border-radius:9999px;transition:background .2s}.config-switch-slider[_ngcontent-%COMP%]:after{content:"";position:absolute;top:2px;left:2px;width:1.25rem;height:1.25rem;background:var(--color-text-primary);border-radius:50%;transition:transform .2s}.config-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .config-switch-slider[_ngcontent-%COMP%]{background:var(--color-primary)}.config-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .config-switch-slider[_ngcontent-%COMP%]:after{transform:translate(1.5rem)}.config-notif-info[_ngcontent-%COMP%]{padding:1rem;background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);border-radius:var(--border-radius-md);border-left:2px solid var(--color-primary)}.config-notif-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.5;color:var(--color-text-secondary);margin:0}.config-help-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--color-primary-light) 0%,transparent 100%);border:1px solid color-mix(in srgb,var(--color-primary) 25%,transparent);border-radius:.75rem;padding:1.5rem;position:relative;overflow:hidden}.config-help-icon[_ngcontent-%COMP%]{position:absolute;right:-1rem;bottom:-1rem;font-size:5rem;color:var(--color-primary);opacity:.12}.config-help-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;text-transform:uppercase;letter-spacing:.03em;color:var(--color-text-primary);margin:0 0 .5rem}.config-help-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary);margin:0 0 1rem;line-height:1.4}.config-help-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;font-size:.75rem;font-weight:800;text-transform:uppercase;letter-spacing:.1em;color:var(--color-primary);text-decoration:none;transition:text-decoration .2s}.config-help-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.config-help-arrow[_ngcontent-%COMP%]{font-size:.875rem}.config-error[_ngcontent-%COMP%], .config-muted[_ngcontent-%COMP%]{margin:0;padding:.5rem 0}.config-error[_ngcontent-%COMP%]{color:#f87171}.config-muted[_ngcontent-%COMP%]{color:var(--color-text-secondary)}']})};export{I as DashboardConfiguracionComponent};
