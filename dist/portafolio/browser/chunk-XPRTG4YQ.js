import{a as W}from"./chunk-BHQHOUID.js";import{b as Y,c as w,d as b,e as y,f as H,j as J,k as K,m as Q,n as U,u as X,v as Z,w as $,x as ee}from"./chunk-J666E7JD.js";import{a as j}from"./chunk-WV3CAMKT.js";import"./chunk-JB5K5Y3O.js";import"./chunk-MQB6D6E4.js";import{d as G,f as q,g as B}from"./chunk-N2ECJDZB.js";import"./chunk-27IFVBVS.js";import"./chunk-SFS47BZX.js";import{k as _,s as x}from"./chunk-XPIPXS6X.js";import{Ab as f,Bb as T,Cb as z,Eb as O,Ib as u,Jb as m,Qb as D,Rb as i,Sb as N,Tb as A,Ua as l,Wb as E,Xb as I,Yb as k,Za as F,_ as h,cb as C,fa as p,fc as R,ga as g,hb as v,ob as L,pb as c,ra as P,rb as S,sb as V,yb as t,zb as r}from"./chunk-PWGBBCAH.js";function ae(s,n){s&1&&(t(0,"span",18),i(1,"Email v\xE1lido requerido"),r())}function se(s,n){s&1&&(t(0,"span",18),i(1,"M\xEDnimo 6 caracteres"),r())}var M=class s{constructor(n){this.fb=n;this.form=this.fb.group({email:["",[b.required,b.email]],password:["",[b.required,b.minLength(6)]]})}submitForm=P();close=P();form;isFieldInvalid(n){let e=this.form.get(n);return!!e&&e.invalid&&(e.dirty||e.touched)}showPassword=!1;togglePassword(){this.showPassword=!this.showPassword}onSubmit(){this.form.valid?this.submitForm.emit(this.form.value):Object.keys(this.form.controls).forEach(n=>this.form.get(n)?.markAsTouched())}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||s)(F(Z))};static \u0275cmp=C({type:s,selectors:[["app-login-form"]],outputs:{submitForm:"submitForm",close:"close"},decls:25,vars:12,consts:[[1,"auth-form"],[1,"auth-title"],[1,"auth-subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","login-email"],[1,"input-with-icon"],[1,"fas","fa-envelope","input-icon"],["id","login-email","type","email","formControlName","email","placeholder","tu@email.com","autocomplete","username email"],["class","error-msg",4,"ngIf"],["for","login-password"],[1,"password-input-wrapper","input-with-icon"],[1,"fas","fa-lock","input-icon"],["id","login-password","formControlName","password","placeholder","********","autocomplete","current-password",1,"password-input-field",3,"type"],["type","button",1,"password-toggle",3,"click"],["aria-hidden","true"],[1,"auth-actions"],["type","submit",1,"btn-submit",3,"disabled"],[1,"error-msg"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"h2",1),i(2,"Ingresar"),r(),t(3,"p",2),i(4,"Ingresa tus credenciales para acceder"),r(),t(5,"form",3),u("ngSubmit",function(){return o.onSubmit()}),t(6,"div",4)(7,"label",5),i(8,"Email"),r(),t(9,"div",6),f(10,"i",7)(11,"input",8),r(),v(12,ae,2,0,"span",9),r(),t(13,"div",4)(14,"label",10),i(15,"Contrase\xF1a"),r(),t(16,"div",11),f(17,"i",12)(18,"input",13),t(19,"button",14),u("click",function(){return o.togglePassword()}),f(20,"i",15),r()(),v(21,se,2,0,"span",9),r(),t(22,"div",16)(23,"button",17),i(24,"Entrar"),r()()()()),e&2&&(l(5),c("formGroup",o.form),l(6),S("error",o.isFieldInvalid("email")),l(),c("ngIf",o.isFieldInvalid("email")),l(6),S("error",o.isFieldInvalid("password")),c("type",o.showPassword?"text":"password"),l(),L("aria-label",o.showPassword?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),l(),V(o.showPassword?"fas fa-eye":"fas fa-eye-slash"),l(),c("ngIf",o.isFieldInvalid("password")),l(2),c("disabled",o.form.invalid))},dependencies:[ee,K,w,y,H,Q,U,x,_],styles:[".auth-form[_ngcontent-%COMP%]{padding:.5rem}.auth-title[_ngcontent-%COMP%]{color:var(--color-primary);font-size:1.75rem;font-weight:700;margin-bottom:.5rem;text-align:center}.auth-subtitle[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:.8125rem;text-transform:uppercase;letter-spacing:.05em;text-align:center;margin-bottom:2rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--color-text-secondary);font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;margin-bottom:.5rem;margin-left:.25rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem .875rem 2.75rem;background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);border:1px solid color-mix(in srgb,var(--color-text-primary) 25%,transparent);border-radius:var(--border-radius-md);color:var(--color-text-primary);font-size:1rem;transition:border-color .2s,box-shadow .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--color-text-secondary);opacity:.5}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 2px color-mix(in srgb,var(--color-primary) 25%,transparent)}.form-group[_ngcontent-%COMP%]   input.error[_ngcontent-%COMP%]{border-color:var(--error)}.input-with-icon[_ngcontent-%COMP%]{position:relative;width:100%}.input-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:var(--color-text-secondary);font-size:1rem;pointer-events:none;z-index:2;transition:color .2s ease}.password-input-wrapper[_ngcontent-%COMP%]{position:relative;width:100%}.password-input-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]{left:1rem}.password-input-field[_ngcontent-%COMP%]{padding-right:3rem;width:100%}.password-toggle[_ngcontent-%COMP%]{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);background:transparent;border:none;cursor:pointer;padding:.5rem;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);transition:color .2s ease;min-width:32px;min-height:32px;z-index:1}.password-toggle[_ngcontent-%COMP%]:hover{color:var(--color-primary)}.password-toggle[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--primary-color);outline-offset:2px}.password-toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem;color:currentColor}.error-msg[_ngcontent-%COMP%]{color:var(--error);font-size:.8rem;margin-top:.25rem;display:block}.auth-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:1.25rem}.btn-cancel[_ngcontent-%COMP%], .btn-submit[_ngcontent-%COMP%]{flex:1;padding:.6rem 1rem;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s}.btn-cancel[_ngcontent-%COMP%]{background:transparent;color:var(--text-secondary);border:1px solid var(--border-color)}.btn-cancel[_ngcontent-%COMP%]:hover{background:var(--background-card);color:var(--text-primary);border-color:var(--border-hover)}.btn-submit[_ngcontent-%COMP%]{background:var(--color-primary);color:var(--background-dark);border:none;font-weight:800;text-transform:uppercase;letter-spacing:.05em;box-shadow:var(--shadow-neon)}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){filter:brightness(1.1);box-shadow:0 0 20px color-mix(in srgb,var(--color-primary) 40%,transparent);transform:translateY(-2px)}.btn-submit[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed;box-shadow:none}"]})};function le(s,n){if(s&1&&(t(0,"p",5),i(1),r()),s&2){let e=m();l(),N(e.serverError)}}function ce(s,n){if(s&1){let e=O();T(0),t(1,"app-login-form",6),u("submitForm",function(a){p(e);let d=m();return g(d.onSubmit(a))})("close",function(){p(e);let a=m();return g(a.onClose())}),r(),t(2,"p",7),i(3," No tienes cuenta? "),t(4,"a",8),i(5,"Registrarse"),r(),f(6,"br"),t(7,"a",9),i(8,"Olvidaste tu password?"),r()(),z()}}function me(s,n){if(s&1){let e=O();t(0,"div",10)(1,"h2",11),i(2,"Verificacion 2FA"),r(),t(3,"p",12),i(4,"Ingresa el codigo de Google Authenticator"),r(),t(5,"p",13),i(6),r(),t(7,"div",14)(8,"label",15),i(9,"Codigo"),r(),t(10,"input",16),k("ngModelChange",function(a){p(e);let d=m();return I(d.mfaCode,a)||(d.mfaCode=a),g(a)}),r()(),t(11,"label",17)(12,"input",18),k("ngModelChange",function(a){p(e);let d=m();return I(d.trustThisDevice,a)||(d.trustThisDevice=a),g(a)}),r(),i(13," Confiar en este dispositivo "),r(),t(14,"div",19)(15,"button",20),u("click",function(){p(e);let a=m();return g(a.cancelMfaStep())}),i(16,"Volver"),r(),t(17,"button",21),u("click",function(){p(e);let a=m();return g(a.onSubmitMfa())}),i(18," Verificar "),r()()()}if(s&2){let e=m();l(6),A("Expira en ",e.challengeExpiresInSec,"s"),l(4),E("ngModel",e.mfaCode),l(2),E("ngModel",e.trustThisDevice),l(5),c("disabled",e.mfaCode.length<6)}}var te=class s{router=h(q);route=h(G);authService=h(W);authStateService=h(j);serverError="";pendingChallengeId=null;mfaCode="";trustThisDevice=!0;challengeExpiresInSec=0;challengeCountdownId=null;ngOnInit(){if(this.route.snapshot.queryParamMap.get("reason")==="2fa-disabled"&&(this.serverError="Se desactivo 2FA y por seguridad cerramos tu sesion. Inicia sesion nuevamente."),this.authStateService.value.isAuthenticated){this.router.navigate(["/dashboard"]);return}}ngOnDestroy(){this.clearChallengeCountdown()}onClose(){this.router.navigate(["/home"])}onSubmit(n){this.serverError="",this.authService.login(n.email,n.password).subscribe({next:e=>{if(e.mfaRequired&&e.challengeId){this.pendingChallengeId=e.challengeId,this.mfaCode="",this.challengeExpiresInSec=e.challengeExpiresInSec??300,this.startChallengeCountdown();return}e.user&&(this.authStateService.setAuthenticated(e.user),this.router.navigate(["/dashboard"]))},error:e=>{if(e.status===403&&e.error?.message?.includes("verificado")){this.router.navigate(["/verify-email-pending"],{queryParams:{email:n.email,fromLogin:"true"}});return}this.serverError=e.error?.message||"Email o password invalidos"}})}onSubmitMfa(){this.pendingChallengeId&&(this.serverError="",this.authService.verifyLogin2FA({challengeId:this.pendingChallengeId,code:this.mfaCode,trustThisDevice:this.trustThisDevice,deviceName:"Browser"}).subscribe({next:n=>{this.clearChallengeState(),n.user&&(this.authStateService.setAuthenticated(n.user),this.router.navigate(["/dashboard"]))},error:n=>{this.serverError=n.error?.message||"Codigo 2FA invalido"}}))}cancelMfaStep(){this.clearChallengeState(),this.serverError=""}startChallengeCountdown(){this.clearChallengeCountdown(),this.challengeCountdownId=setInterval(()=>{if(this.challengeExpiresInSec<=0){this.serverError="El desafio 2FA expiro. Vuelve a iniciar sesion.",this.clearChallengeState();return}this.challengeExpiresInSec-=1},1e3)}clearChallengeCountdown(){this.challengeCountdownId&&(clearInterval(this.challengeCountdownId),this.challengeCountdownId=null)}clearChallengeState(){this.clearChallengeCountdown(),this.pendingChallengeId=null,this.mfaCode="",this.challengeExpiresInSec=0}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=C({type:s,selectors:[["app-login"]],decls:6,vars:3,consts:[["mfaStep",""],[1,"auth-page"],[1,"auth-container"],["class","auth-error",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"auth-error"],[3,"submitForm","close"],[1,"auth-footer"],["routerLink","/register"],["routerLink","/forgot-password"],[1,"mfa-form"],[1,"auth-title"],[1,"auth-subtitle"],[1,"mfa-time"],[1,"form-group"],["for","mfa-code"],["id","mfa-code","type","text","maxlength","6","inputmode","numeric","autocomplete","one-time-code","placeholder","123456",3,"ngModelChange","ngModel"],[1,"mfa-trust"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"auth-actions"],["type","button",1,"btn-cancel",3,"click"],["type","button",1,"btn-submit",3,"click","disabled"]],template:function(e,o){if(e&1&&(t(0,"section",1)(1,"div",2),v(2,le,2,1,"p",3)(3,ce,9,0,"ng-container",4)(4,me,19,4,"ng-template",null,0,R),r()()),e&2){let a=D(5);l(2),c("ngIf",o.serverError),l(),c("ngIf",!o.pendingChallengeId)("ngIfElse",a)}},dependencies:[x,_,$,w,Y,y,X,J,M,B],styles:[".auth-page[_ngcontent-%COMP%]{min-height:80vh;display:flex;align-items:center;justify-content:center;padding:2rem}.auth-container[_ngcontent-%COMP%]{width:100%;max-width:420px;background:color-mix(in srgb,var(--color-primary) 6%,var(--background-dark));-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid color-mix(in srgb,var(--color-primary) 12%,transparent);border-radius:.75rem;padding:2.5rem;transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:var(--shadow-card)}.auth-container[_ngcontent-%COMP%]:hover{transform:translateY(-4px);border-color:var(--color-primary);box-shadow:var(--shadow-neon)}.auth-error[_ngcontent-%COMP%]{color:var(--error, #e74c3c);font-size:.9rem;margin-bottom:1rem;text-align:center}.auth-footer[_ngcontent-%COMP%]{text-align:center;margin-top:1.25rem;font-size:.95rem;color:var(--text-secondary)}.auth-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary-color);text-decoration:none;font-weight:600}.auth-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.mfa-form[_ngcontent-%COMP%]{padding:.5rem}.auth-title[_ngcontent-%COMP%]{color:var(--color-primary);font-size:1.75rem;font-weight:700;margin-bottom:.5rem;text-align:center}.auth-subtitle[_ngcontent-%COMP%]{color:var(--color-text-secondary);font-size:.8125rem;text-transform:uppercase;letter-spacing:.05em;text-align:center;margin-bottom:1rem}.mfa-time[_ngcontent-%COMP%]{color:var(--text-secondary);text-align:center;margin:0 0 1rem;font-size:.9rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:var(--color-text-secondary);font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.08em;margin-bottom:.5rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem;background:color-mix(in srgb,var(--color-text-primary) 8%,transparent);border:1px solid color-mix(in srgb,var(--color-text-primary) 25%,transparent);border-radius:var(--border-radius-md);color:var(--color-text-primary);font-size:1rem}.mfa-trust[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--text-secondary);font-size:.9rem;margin-bottom:1rem}.auth-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.btn-cancel[_ngcontent-%COMP%], .btn-submit[_ngcontent-%COMP%]{flex:1;padding:.6rem 1rem;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer}.btn-cancel[_ngcontent-%COMP%]{background:transparent;color:var(--text-secondary);border:1px solid var(--border-color)}.btn-submit[_ngcontent-%COMP%]{background:var(--color-primary);color:var(--background-dark);border:none;font-weight:800;text-transform:uppercase;letter-spacing:.05em}"]})};export{te as LoginComponent};
